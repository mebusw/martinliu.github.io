<!DOCTYPE html>
<html class="no-js">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Martin's Blog | 如何在命令行打XenServer的补丁</title>
    <meta name="description" content="参考文献：">

    <link rel="stylesheet" href="/css/main.css">

    <link rel="canonical" href="http://localhost:4000/2012/11/15/e5-a6-82-e4-bd-95-e5-9c-a8-e5-91-bd-e4-bb-a4-e8-a1-8c-e6-89-93xenserver-e7-9a-84-e8-a1-a5-e4-b8-81/">
    <link rel="alternate" type="application/rss+xml" title="Martin's Blog" href="http://localhost:4000/feed.xml" />

    <!--[if lt IE 9]>
        <script src="/js/vendor/html5shiv.min.js"></script>
    <![endif]-->
</head>


  <body class="">
    <!-- if the user has javascript disabled they can still use the menu -->
<noscript>
    <div class="no-js-menu clearfix">
        <ul>
            
                <li><i class="fa fa-home"></i><a href="/">Home</a></li>
            
                <li><i class="fa fa-home"></i><a href="/home-alt">Home Alt</a></li>
            
                <li><i class="fa fa-home"></i><a href="/home-alt-2/">Home Alt 2</a></li>
            
                <li><i class="fa fa-anchor"></i><a href="/about">About</a></li>
            
                <li><i class="fa fa-plane"></i><a href="/contact">Contact</a></li>
            
                <li><i class="fa fa-user"></i><a href="/author/michelle">Author</a></li>
            
        </ul>
    </div>
</noscript>
<!-- end no script -->

    <header class="hero-image" style="background-image: url(/img/.jpg);">
    <span class="menu-trigger animated fadeInDown">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </span>

    <div id="menu-target">
    <ul>
        
            <li><i class="fa fa-home"></i><a href="/">Home</a></li>
        
            <li><i class="fa fa-home"></i><a href="/home-alt">Home Alt</a></li>
        
            <li><i class="fa fa-home"></i><a href="/home-alt-2/">Home Alt 2</a></li>
        
            <li><i class="fa fa-anchor"></i><a href="/about">About</a></li>
        
            <li><i class="fa fa-plane"></i><a href="/contact">Contact</a></li>
        
            <li><i class="fa fa-user"></i><a href="/author/michelle">Author</a></li>
        
    </ul>
</div>

</header>

<main class="container">
    <div class="row">
        <div class="col-xs-12 single-content">
            <p class="meta">
                <a href=""></a> in <a href='/category/XenServer'>Xenserver</a> <i class="link-spacer"></i> <i class="fa fa-bookmark"></i>  minutes
            </p>

            <h1>如何在命令行打XenServer的补丁</h1>

            <p>参考文献：</p>

<p><a href="http://xmodulo.blogspot.com.au/2012/10/how-to-apply-xenserver-patch.html">http://xmodulo.blogspot.com.au/2012/10/how-to-apply-xenserver-patch.html</a>
Installing the hotfix using the CLI on another host</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. Download the hotfix to the computer running the CLI or XenCenter, and extract the .xsupdate file from the ZIP file.


2. Open a Command Prompt window. On Windows computers, navigate to the XenCenter installation directory, typically located at C:\Program Files (x86)\Citrix\XenCenter


3. Upload the hotfix to the pool master by entering the following command.
</code></pre>
</div>

<blockquote>xe patch-upload -s `<hostname>
```
 -u root -pw `<password>
```
 file-name=`<updatefilepath>
```
 XS55EU2012.xsupdate&lt;/blockquote&gt;


Where <hostname> is the IP address or DNS name of the pool master, <password> is the root account password, and <updatefilepath> is the path to the .xsupdate file.

The UUID of the hotfix is displayed. XenServer assigns the UUID to the .xsupdate file.

	
    4. Type the following command to apply the hotfix to all hosts in the pool.


<blockquote>xe patch-pool-apply uuid=d632016d-352d-4fd9-8829-5a74ef0625db</blockquote>




	
    5. Verify that the update was applied using the following command.


<blockquote>xe patch-list -s `<hostname>
```
 -u root -pw `<password>
```
 name-label=XS55EU2012&lt;/blockquote&gt;


Where <hostname> is the IP address or DNS name of the pool master and <password> is the root account password.

The hosts field contains the UUIDs of the hosts to which the hotfix was successfully applied. If the update is successful, all the hosts in the pool are listed.

	
    6. For each host, migrate any VMs that you want to keep running and shut down the remaining VMs before restarting the host.The hotfix is applied to all hosts in the pool, but does not take effect until each host is restarted.



To verify in XenCenter that the update was applied correctly, select the pool in the resources pane and then click the **General** tab in the properties pane. Expand the **Updates** section of the pool properties and ensure that the update is listed as **Fully applied**.

我的测试过程如下：

建立了一个NFS共享，上传了所有下载并且压缩所有补丁文件，积累了一堆的.xsupdate文件；在master上mount这个nfs文件共享。进去之后我所使用的命令如下：

[bash]
[root@xs-04 602patch]# xe patch-upload file-name =XS602E003.xsupdate
26b72ceb-759c-4de3-b007-e2a5fc30a93a
[root@xs-04 602patch]# xe patch-upload file-name =XS602E004.xsupdate
7f363047-46f2-41b7-8ff2-141d88e7b4ec
[root@xs-04 602patch]# xe patch-upload file-name =XS602E005.xsupdate
9b84b5c0-a027-11e1-a8b1-0800200c9a66
[root@xs-04 602patch]# xe patch-upload  file-name =XS602E006.xsupdate
b6f7bfe0-b969-11e1-afa6-0800200c9a66
[root@xs-04 602patch]# xe patch-upload  file-name =XS602E008.xsupdate
7c04fd30-9a0a-4894-9662-05ca9f866162
[root@xs-04 602patch]# xe patch-upload  file-name =XS602E009.xsupdate
6c9f9c22-d4b9-4c39-9343-7f0e6d0104b5
[root@xs-04 602patch]# xe patch-list 
uuid ( RO) : 7f363047-46f2-41b7-8ff2-141d88e7b4ec
name-label ( RO): XS602E004
name-description ( RO): Public Availability: CVE-2012-0217 security fix
size ( RO): 776629
hosts (SRO):
after-apply-guidance (SRO): restartHost

uuid ( RO) : 945655fe-2dcd-46eb-b224-e556aa2f22b8
name-label ( RO): XS602E002
name-description ( RO): Public Availability: Fix for VMs hanging when pa rsing fragmented IPv6 packet
size ( RO): 0
hosts (SRO): 016c2e53-3e1d-4273-a350-f89447614903
after-apply-guidance (SRO): restartXAPI

uuid ( RO) : 68276dea-a818-4970-af93-3e43cb37b426
name-label ( RO): XS602E001
name-description ( RO): Public Availability: Mark VMs with old PV driver s as out-of-date
size ( RO): 0
hosts (SRO): 016c2e53-3e1d-4273-a350-f89447614903
after-apply-guidance (SRO): restartXAPI

uuid ( RO) : 7c04fd30-9a0a-4894-9662-05ca9f866162
name-label ( RO): XS602E008
name-description ( RO): Public Availability: security fixes to Xen and d evice model
size ( RO): 2784821
hosts (SRO):
after-apply-guidance (SRO): restartHost

uuid ( RO) : b6f7bfe0-b969-11e1-afa6-0800200c9a66
name-label ( RO): XS602E006
name-description ( RO): Public availability: Fixes to Integrated Storage Link.
size ( RO): 14530669
hosts (SRO):
after-apply-guidance (SRO): restartXAPI

uuid ( RO) : 9b84b5c0-a027-11e1-a8b1-0800200c9a66
name-label ( RO): XS602E005
name-description ( RO): Public Availability: Kernel and Storage fixes
size ( RO): 38529042
hosts (SRO):
after-apply-guidance (SRO): restartHost

uuid ( RO) : 6c9f9c22-d4b9-4c39-9343-7f0e6d0104b5
name-label ( RO): XS602E009
name-description ( RO): Public Availability: XenTools fixes
size ( RO): 117525717
hosts (SRO):
after-apply-guidance (SRO):

uuid ( RO) : 26b72ceb-759c-4de3-b007-e2a5fc30a93a
name-label ( RO): XS602E003
name-description ( RO): Public Availability: Xapi hotfix for incorrect V NC port advertisement.
size ( RO): 7454760
hosts (SRO):
after-apply-guidance (SRO): restartXAPI

[root@xs-04 ~]# xe patch-pool-apply  uuid=6c9f9c22-d4b9-4c39-9343-7f 0e6d0104b5
[root@xs-04 ~]# xe patch-pool-apply  uuid=9b84b5c0-a027-11e1-a8b1-08 00200c9a66
[root@xs-04 ~]# xe patch-pool-apply  uuid=b6f7bfe0-b969-11e1-afa6-08 00200c9a66
[root@xs-04 ~]# xe patch-pool-apply  uuid=7f363047-46f2-41b7-8ff2-14 1d88e7b4ec
[root@xs-04 ~]# xe patch-pool-apply  uuid=7c04fd30-9a0a-4894-9662-05
[root@xs-04 ~]#reboot
[/bash]

我是在单机的XenServer上打的补丁，打完之后只需要一次重即可。比较在XenCenter里面打补丁，这个方法更快捷，更节省时间。
</password></hostname></password></hostname></blockquote></updatefilepath></password></hostname></updatefilepath></password></hostname></blockquote>


        </div><!-- main-content/col -->
    </div> <!--/row -->

</main> <!-- /container -->

<footer class="single">
    <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-2">
            <img src="/img/.jpg" class="user-icon " alt="user-image">
        </div>
        <div class="col-xs-12 col-sm-6">
            <div class="category-list">
                <p>Published <span>Nov 15, 2012</span></p>
                <p><a href=""></a> in <a href='/category/XenServer'>Xenserver</a></p>

                <div class="other-catergories">
                    <h3>Also found in</h3>

                    <ul>
                        
                        <li>
                            <a href='/category/XenServer'>Xenserver</a>
                            
                        </li>
                        
                    </ul>
                </div>

            </div>
        </div><!-- end col -->
        <div class="col-xs-12 col-sm-4">
            <div class="social">
                <p>Share this article</a>
                <div class="social-links">
                    <a class="social-icon" href="#" data-platform="twitter" data-message="" data-url="http://localhost:4000/2012/11/15/e5-a6-82-e4-bd-95-e5-9c-a8-e5-91-bd-e4-bb-a4-e8-a1-8c-e6-89-93xenserver-e7-9a-84-e8-a1-a5-e4-b8-81/"><i class="fa fa-twitter"></i></a>

                    <a class="social-icon" href="#" data-platform="facebook" data-message="" data-url="http://localhost:4000/2012/11/15/e5-a6-82-e4-bd-95-e5-9c-a8-e5-91-bd-e4-bb-a4-e8-a1-8c-e6-89-93xenserver-e7-9a-84-e8-a1-a5-e4-b8-81/"><i class="fa fa-facebook-official"></i></a>
                    <a class="social-icon" data-platform="mail"  href="mailto:67120666@qq.com?body=http://localhost:4000/2012/11/15/e5-a6-82-e4-bd-95-e5-9c-a8-e5-91-bd-e4-bb-a4-e8-a1-8c-e6-89-93xenserver-e7-9a-84-e8-a1-a5-e4-b8-81/"><i class="fa fa-envelope"></i></a>
                </div>
            </div>
        </div>
    </div><!-- end row -->
</div>


    
</footer>


    <script src='/js/vendor/modernizr.custom.32229-2.8-respondjs-1-4-2.js'></script>
    <script src="/js/vendor/jquery-1.11.2.min.js"></script>
    <script src='/js/vendor/jquery.jpanelmenu.min.js'></script>
    <script type='application/javascript' src='/js/vendor/fastclick.min.js'></script>
    
    <script src=' /js/main.js'></script>
  </body>

</html>
