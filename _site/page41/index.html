<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Martin's Blog</title>
<meta name="description" content="DevOps Coach & Cloud Expert">
<meta name="keywords" content="DevOps, Cloud, AWS, HCI, Nutanix, ITSM">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://martinliu.cn/images/path.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="DevOps Coach & Cloud Expert">
<meta name="twitter:creator" content="@zliu">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="DevOps Coach & Cloud Expert">
<meta property="og:url" content="http://martinliu.cn/page41/">
<meta property="og:site_name" content="Martin's Blog">

<meta name="google-site-verification" content="4oSwNTpy1vzip3_lt6XhkhMfImCD_DZlvL3K1k-M8qk">



<link rel="canonical" href="http://martinliu.cn/page41/">
<link href="http://martinliu.cn/feed.xml" type="application/atom+xml" rel="alternate" title="Martin's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://martinliu.cn/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://martinliu.cn/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://martinliu.cn/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://martinliu.cn/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://martinliu.cn/images/apple-touch-icon.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://martinliu.cn/images/apple-touch-icon-72x72.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://martinliu.cn/images/apple-touch-icon-114x114.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://martinliu.cn/images/apple-touch-icon-144x144.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://martinliu.cn/">首页</a></li>
		<li>
			<a href="#">关于</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://martinliu.cn/images/avatar.jpg" alt="Martin Liu photo" class="author-photo">
					<h4>Martin Liu</h4>
					<p>DevOps Coach, Cloud Expert, Runner</p>
				</li>
				<li><a href="http://martinliu.cn/about/"><span class="btn btn-inverse">详情</span></a></li>
				<li>
					<a href="mailto:67120666@qq.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/zliu"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://google.com/+MartinLiu-cn"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="https://linkedin.com/in/liuzheng"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/martinliu"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">文章</a>
			<ul class="dl-submenu">
				<li><a href="http://martinliu.cn/posts/">所有文章</a></li>
				<li><a href="http://martinliu.cn/tags/">所有分类</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="http://martinliu.cn/images/path.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Martin's Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-08-22T21:47:59+08:00"><a href="http://martinliu.cn/2012/08/22/e6-b9-96-e5-8d-97-e5-b2-b3-e9-98-b3/">August 22, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2012/08/22/e6-b9-96-e5-8d-97-e5-b2-b3-e9-98-b3/" rel="bookmark" title="湖南岳阳" itemprop="url">湖南岳阳</a></h1>
    
  </header>
  <div class="entry-content">
    <p>打上飞的，我到了长沙机场，坐上高铁我到了湖南岳阳。第一次来湖南。明天是一个重要的客户会议，客户方湖南全省十几二十个地市的信息中心的主任都纷至沓来，明天的ppt和demo一定要给力。</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-08-22T21:18:39+08:00"><a href="http://martinliu.cn/2012/08/22/e6-9c-89-e4-ba-ba-e8-bf-99-e4-b9-88-e6-af-94-e8-be-83openstack-e5-92-8ccloudstack/">August 22, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2012/08/22/e6-9c-89-e4-ba-ba-e8-bf-99-e4-b9-88-e6-af-94-e8-be-83openstack-e5-92-8ccloudstack/" rel="bookmark" title="有人这么比较OpenStack和CloudStack" itemprop="url">有人这么比较OpenStack和CloudStack</a></h1>
    
  </header>
  <div class="entry-content">
    <p><a href="http://cdn1.martinliu.cn/wp-content/uploads/2012/08/os-vs-cs.png"><img src="http://cdn1.martinliu.cn/wp-content/uploads/2012/08/os-vs-cs.png" alt="" /></a></p>

<blockquote>
•Started by a single vendor
•Developed by a single vendor
•Marketed by a single vendor
•With the goal to create a veil of “no vendor lock-in”
From: Mirantis OpenStack Apac summit PPT
</blockquote>

<p>Mirantis 是谁？google it。 Mirantis貌似是最大的OpenStack服务提供商之一，上面原文是来自最近的OpenStack Apac峰会上Mirantis的ppt，所以很显然，你知道它为啥这么去鼓吹OpenStack了吧？我对此很不同意，如果他们在CloudStack上也有钱赚的话，还会这么说？所以有下面的话想说，想谈点我所知道的事实。</p>

<p>CloudStack起源一些成功的数据中心IaaS项目实施，后来成功的转身为一个开源项目，后来向所有创业项目一样成功的获得风投，买下Cloud.com域名，后来被Citrix收购，后来被捐献给Apache，目前由Apache社区来运作开源版本。Citrix是一个提供商业支持的vendor，目前大多数开源软件的盈利模式都是这样，我没有看出来CloudStack是那个vendor开创和控制的。</p>

<p>如果你深入CloudStack开发者社区邮件组的话，你会发现，有太多来自全球各种公司向这个项目做贡献的，非常多的个人贡献者。最近看见一个CloudStack架构重构的帖子，我看到n多的人提交他们的建议和想法，看到了私有软件厂商架构师不可能完成的工作量。而这些人是谁，你看看他们的邮箱地址就知道，他们大多数不是citrix.com邮箱地址。</p>

<p>CloudStack在全球有最多的IaaS的大规模生产环境项目实施，它们各自在做自己的市场宣传；他们可能不会说底层是CloudStack，但是，大家都知道，有一种无法Marketing的东西叫做口碑，随着CloudStack的实施案例逐渐增多，我想CloudStack的用户社区就是它最好的宣传了。</p>

<p>无厂商锁定不是一个面纱，而是用户的一真实需求，这不需要提醒用户，用户也能想到吧！</p>

<p>CloudStack是一个目前市场上最成熟的IaaS软件，是一个用户最有价值的选择，是一个用户可以快速实践并积累经验的技术平台；我们已经进了云时代的门，没有必要做学术研究，没有必要务虚，但求尽快的能投产，尽快的能积累到IaaS的实战经验，它是一种全新的数据中心生产运作的方式，云平台管理经验来自正确的实践路径；道路曲折与否，时间长短，没人能替用户选择。</p>

<p>我不会去攻击OpenStack，开源世界原本就是这样，多种选项并存，相互促进，相互学习，而且以后还会有很对Stack出现；我个人同时喜欢并且使用多个Linux版本，包括openSuse,Ubuntu,CentOS；你会发现Linux有n个发行版本，没有任何一家跳出来去攻击和贬低他人的。有空我一定会也研究下OpenStack，Why not？</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-08-20T23:59:40+08:00"><a href="http://martinliu.cn/2012/08/20/e9-97-ae-e4-b8-96-e9-97-b4-xenserver-ddk-e4-b8-ba-e4-bd-95-e7-89-a9/">August 20, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2012/08/20/e9-97-ae-e4-b8-96-e9-97-b4-xenserver-ddk-e4-b8-ba-e4-bd-95-e7-89-a9/" rel="bookmark" title="问世间 XenServer DDK 为何物？" itemprop="url">问世间 XenServer DDK 为何物？</a></h1>
    
  </header>
  <div class="entry-content">
    <p>我们都知道Citrix Receiver有一种特有的能力“Say Yes to any device！！！”；那么于此相同的DDK也是这样一种工具，让XenServer对各种扩展需求说Yes！！！</p>

<p>我们都装过XenServer，是否都在加载supplemental packs的地方点击不装，接着做后面的安装；可是我们有没有问过什么是“supplemental packs”？</p>

<blockquote>Supplemental packs consist of a number of packages along with information describing their relationship to other
packs. Individual packages are in the Red Hat RPM file format, and must be able to install and uninstall cleanly
on a fresh installation of XenServer.
Packs are created using the XenServer Driver Development Kit (DDK). This has been extended to not only allow
the creation of supplemental packs containing only drivers (also known as driver disks), but also packs containing
userspace software to be installed into dom0.
Examples and tools are included in the XenServer DDK to help developers create their own supplemental packs.
However, for partners wishing to integrate pack creation into their existing build environments, only a few scripts
taken from the DDK are necessary.
**_From --&gt; [CTX130425](http://support.citrix.com/article/CTX130425/)_**</blockquote>

<p>从以上可以看到这样几个重要的内容：</p>

<ol>
  <li>
    <p>supplemental pack是rpm格式的软件包，可以用于XenServer安装过程中装，也可以在XenServer安装完了之后用xen命令安装</p>
  </li>
  <li>
    <p>软件包不属于XenServer服务器软件基础的一部分，是用户定制化需求的扩展，这些扩展的目的有：扩展硬件设备驱动、在Dom0里装监控或者管理软件或者在Dom0里面装任何特定功能的软件或者数据。</p>
  </li>
  <li>
    <p>supplemental pack是由DDK来生成并且创建</p>
  </li>
  <li>
    <p>创建出来的功能必须是靠谱的，应该经过仔细的评估和测试（我加的话）</p>
  </li>
</ol>

<p>那么DDK是个什么东西？它的学名是“XenServer驱动开发工具包”，但是，你可以看出它其实还能够放其它软件或者数据在Dom0中。DDK有很多版本，假如目前正在运行的XenServer的一个补丁出来了，这个补丁修改了内核版本号（通常大一点的，或者硬件驱动补丁打上后都会改变Kernel的版本号），那么不久就有相应版本的DDK出来与之匹配了。如果，你是由于某个型号Raid卡的型号不兼容，需要给XenSenver在安装过程中就加载驱动的，那么你使用的DDK的版本要和安装盘的版本一致（注意这是安装盘，kernel肯定还没有被任何补丁修改过的）；在citrix知识库里面搜ddk.iso你可以发现一系列的DDK包。所以要选择合适的DDK，否则做出来的东西可能可能不被XenServer接受，在安装的时候由于内核不匹配而安装失败。</p>

<p>DDK下载完成之后，把ISO文件解压缩后，可以看到，原来它是一个虚拟机；用XenCenter导入到XenServer上的后，给添加一个网卡，最好有DHCP的网络，省的手工设置IP的麻烦。导入完，启动之后，需要在console上设新的root密码。设置完成之后，就可以使ssh客户端登陆了。这是一个编译环境，这意味着，它具备编译内核的各种条件，包括：它本身内核的源码、编译器、Make工具和实例代码。</p>

<p>实例代码很有意思，在/root/example目录下面，有我们最熟悉不过的Helloworld程序，在该目录下面直接可以执行如下的编译命令：
[shell]
make build-srctarballs
make build-iso
[/shell]
执行完这两个命令之后，我么可以看到，目录里面多出几个文件：
• .iso - the supplemental pack CD image.
• metadata.md5 - a fingerprint to be used to verify the integrity of a pack at installation time.
• .iso.md5 - a fingerprint which can be used to verify the integrity of the ISO at download time.
没错，这些文件就是一个HelloWorld Supplemental pack的安装文件了，你可以把它copy到一个运行的XenServer服务器上用xen命令安装完，重启XenServer之后，你就能看到这个实例程序的功能是修改内核，让修改之后的内核启动的和关闭的时候能在系统启动日志中打印的hello world文字。它其实是一个正经的XenServer内核的补丁，是一个正经的Linux的内核补丁，那么这种补丁的意义和作用就有很多了，多用来扩展系统的硬件驱动（网卡、光纤卡等等）或者其它操作系统底层的功能。</p>

<p>说了这么多，那么当由于Raid卡不兼容，拿着安装盘，连XenServer都装不上的时候究竟该怎么搞？简单的思路是这样的。</p>

<ol>
  <li>
    <p>用此安装盘在能安装的机器上，先装上一个活的XenServer，不打任何补丁</p>
  </li>
  <li>
    <p>下载并导入对应版本的DDK虚拟机</p>
  </li>
  <li>
    <p>下载与合适版本的驱动程序源代码；一般XenServer6内核是CentOS6的，那么下载源码的时候要看是支持CentOS6的才行；有些厂商可能会发布支持Xen或者XenServer版本的驱动，这样则更好</p>
  </li>
  <li>
    <p>上传驱动源码到DDK中去，使用命令编译并制作成Supplemental pack文件；把编完的驱动在DDK中安装一下/或者手工挂在编好的Kernel补丁文件，看看是否它能够被正确的加载到DDK的内核中，应该必须能够被加载成功</p>
  </li>
  <li>
    <p>把最终版本的驱动程序的ISO文件刻盘待用</p>
  </li>
  <li>
    <p>在回到目标的服务器上拿着安装盘和这张驱动盘，在是否加载支持包的窗口，插入新作的驱动盘</p>
  </li>
  <li>
    <p>加载Raid卡驱动后，在后续的步骤中就应该能认到硬盘了，完成剩下的安装过程</p>
  </li>
</ol>

<p>以上还只是纸上谈兵，今天由于没有找到一款老LSI RAID卡合适的驱动程序，所以没能够完全验证以上思路是否完全正确，有不足之处欢迎斧正。</p>

<p>如果那位合作伙伴工程师能把DDK熟练掌握，你能把以上步骤搞顺利的话；那么我认为您已经很牛了，您已经具备了对各种XenServer的扩展需求说Yes能力；因此建议和老板商量涨工资的事情，是时候了！</p>

<p>致谢：MaHong，HansQin的帮助</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-08-20T00:28:51+08:00"><a href="http://martinliu.cn/2012/08/20/e5-81-b6-e9-81-87mindnode/">August 20, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2012/08/20/e5-81-b6-e9-81-87mindnode/" rel="bookmark" title="偶遇MindNode" itemprop="url">偶遇MindNode</a></h1>
    
  </header>
  <div class="entry-content">
    <p><img src="http://mindnode.com/style/img/logo.png" alt="" />之前常用些Maind Map之类的工具，有些工具功能还相当的复杂和强大；今天偶遇MindNode，装上之后发现风格极为简约，功能包括建立节点、子节点、创建连接等；我目前还想不到有什么功能是必须的，而这个软件没有的，推荐一下，Mac用户可以尝试一下。</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-08-18T19:50:07+08:00"><a href="http://martinliu.cn/2012/08/18/cloudstack-quick-install-guide-english-mini-version/">August 18, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~8 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2012/08/18/cloudstack-quick-install-guide-english-mini-version/" rel="bookmark" title="CloudStack Quick install guide (English mini version)" itemprop="url">CloudStack Quick install guide (English mini version)</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Testing environment:
I have two hight spec laptop connecting to one wireless router, they all have internet access.
Install process: step 1 install RHEL6 for management server; step 2 install CloudStack software on management server; step 3 install XenServer; step 4 CloudStack initialization and configure.<!-- more -->
Install RHEL6 64bit OS notes:</p>

<ol>
  <li>
    <p>User FQDN as hostname, for example cloudstack.xen.cn; use this command to confirm: hostname –fqdn</p>
  </li>
  <li>
    <p>Use 0~3.xenserver.pool.ntp.org as ntp server</p>
  </li>
  <li>
    <p>Install KDE desktop, with MySQL/Clent</p>
  </li>
  <li>
    <p>Configure static ip address, for sure both DNS and GW are all right, for internet download.</p>
  </li>
  <li>
    <p>Shutdown iptables firewall, by this way you could ignore port settings of iptables, this is not secure, but you can speed up a little bit</p>
  </li>
</ol>

<p><a href="http://martinliu.cn/2012/06/cloudstack-quick-install-guide.html/img_0841"><img src="http://cdn1.martinliu.cn/wp-content/uploads/2012/06/IMG_0841.jpg" alt="" /></a>
Setting up local DVD as yum source, in order to install dependance packages of Cladestack, mount DVD to /media folder, you have to install following rpm packages before create a new yum source.
[shell]
mount /dev/cdrom /media
yum install deltarpm-3.5-0.5.20090913git.el6.x86_64.rpm
yum install python-deltarpm-3.5-0.5.20090913git.el6.x86_64.rpm
yum install createrepo-0.9.8-4.el6.noarch.rpm
[/shell]</p>

<p>Crete a new yum source file, see below:
[shell]
[root@cloudstack 1] cat /etc/yum.repos.d/rhel6.repo
[rhel6]
name=rhel6
baseurl=file:///media/
enabled=1
gpgcheck=0
[/shell]</p>

<p>Checking if new source file is loaded correctly:
[shell]
yum list
[/shell]</p>

<p>Download CloudStack install package for RHEL 6, unzip it and execute install command
[shell]
tar xzvf CloudStack-oss-3.0.2-1-rhel6.2.tar.gz
./install
Select m
Select y
[/shell]</p>

<p>You will see install script need yum to install all dependence rpm packages; you should get a different list as below:</p>

<p>[shell]
tomcat6-lib                          noarch          6.0.24-33.el6               rhel6               2.9 M
tomcat6-servlet-2.5-api              noarch          6.0.24-33.el6               rhel6                93 k
ws-commons-util                      noarch          1.0.1-13.el6                rhel6                37 k
wsdl4j                               noarch          1.5.2-7.8.el6               rhel6               157 k
xml-commons-apis                     x86_64          1.3.04-3.6.el6              rhel6               439 k
xml-commons-resolver                 x86_64          1.1-4.18.el6                rhel6               145 k</p>

<h1 id="transaction-summary">Transaction Summary</h1>
<p>Install      38 Package(s)</p>

<p>Total download size: 91 M
Installed size: 172 M
Is this ok [y/N]: y
Downloading Packages:
————————————————————————————————————
Total                                                                       115 MB/s |  91 MB     00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
Installing : libgcj-4.4.6-3.el6.x86_64                                                               1/38
Installing : jakarta-commons-logging-1.0.4-10.el6.noarch                                             2/38
Installing : cloud-deps-3.0.2-1.el6.x86_64                                                           3/38
Installing : cloud-utils-3.0.2-1.el6.x86_64                                                          4/38</p>

<p>Installed:
cloud-client.x86_64 0:3.0.2-1.el6</p>

<p>Dependency Installed:
axis.noarch 0:1.2.1-7.2.el6                            bcel.x86_64 0:5.2-7.2.el6
classpathx-jaf.x86_64 0:1.0-15.4.el6                   classpathx-mail.noarch 0:1.1.1-9.4.el6
cloud-agent-scripts.x86_64 0:3.0.2-1.el6               cloud-client-ui.x86_64 0:3.0.2-1.el6
cloud-core.x86_64 0:3.0.2-1.el6                        cloud-deps.x86_64 0:3.0.2-1.el6
cloud-python.x86_64 0:3.0.2-1.el6                      cloud-server.x86_64 0:3.0.2-1.el6
cloud-setup.x86_64 0:3.0.2-1.el6                       cloud-utils.x86_64 0:3.0.2-1.el6
ecj.x86_64 1:3.4.2-6.el6                               ipmitool.x86_64 0:1.8.11-12.el6
jakarta-commons-collections.noarch 0:3.2.1-3.4.el6     jakarta-commons-daemon.x86_64 1:1.0.1-8.9.el6
jakarta-commons-dbcp.noarch 0:1.2.1-13.8.el6           jakarta-commons-discovery.noarch 1:0.4-5.4.el6
jakarta-commons-httpclient.x86_64 1:3.1-0.6.el6        jakarta-commons-logging.noarch 0:1.0.4-10.el6
jakarta-commons-pool.x86_64 0:1.3-12.7.el6             java-1.5.0-gcj.x86_64 0:1.5.0.0-29.1.el6
java_cup.x86_64 1:0.10k-5.el6                          libgcj.x86_64 0:4.4.6-3.el6
log4j.x86_64 0:1.2.14-6.4.el6                          mx4j.noarch 1:3.0.1-9.13.el6
regexp.x86_64 0:1.5-4.4.el6                            sinjdoc.x86_64 0:0.5-9.1.el6
tomcat6.noarch 0:6.0.24-33.el6                         tomcat6-el-2.1-api.noarch 0:6.0.24-33.el6
tomcat6-jsp-2.1-api.noarch 0:6.0.24-33.el6             tomcat6-lib.noarch 0:6.0.24-33.el6
tomcat6-servlet-2.5-api.noarch 0:6.0.24-33.el6         ws-commons-util.noarch 0:1.0.1-13.el6
wsdl4j.noarch 0:1.5.2-7.8.el6                          xml-commons-apis.x86_64 0:1.3.04-3.6.el6
xml-commons-resolver.x86_64 0:1.1-4.18.el6</p>

<p>Complete!
Done
[/shell]
At this point, management server has been installed successfully on my 8GB laptop.</p>

<p>Install MySQL server from CloudStack install script:
[shell]
./install
&gt; select d
Installing the MySQL server…
Loaded plugins: product-id, refresh-packagekit, security, subscription-manager
Updating certificate-based repositories.
cloud-temp                                                                          | 2.6 kB     00:00 …
rhel6                                                                               | 4.0 kB     00:00 …
Setting up Install Process
Package mysql-server-5.1.52-1.el6_0.1.x86_64 already installed and latest version
Nothing to do
Starting the MySQL server…
Initializing MySQL database： Installing MySQL system tables…
OK
Filling help tables…
OK</p>

<p>To start mysqld at boot time you have to copy
support-files/mysql.server to the right place for your system</p>

<p>PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
To do so, start the server, then issue the following commands:</p>

<p>/usr/bin/mysqladmin -u root password ‘new-password’
/usr/bin/mysqladmin -u root -h cloudstack.xen.cn password ‘new-password’</p>

<p>Alternatively you can run:
/usr/bin/mysql_secure_installation</p>

<p>which will also give you the option of removing the test
databases and anonymous user created by default.  This is
strongly recommended for production servers.</p>

<p>See the manual for more instructions.</p>

<p>You can start the MySQL daemon with:
cd /usr ; /usr/bin/mysqld_safe &amp;</p>

<p>You can test the MySQL daemon with mysql-test-run.pl
cd /usr/mysql-test ; perl mysql-test-run.pl</p>

<p>Please report any problems with the /usr/bin/mysqlbug script!</p>

<p>[OK]
Starting mysqld：                                          [OK]
Done
[/shell]</p>

<p>We had installed MySQL server successfully; some parameters must be changed from default value. I show my configure file as a simple bellow:</p>

<p>[shell]
cat /etc/my.cfn
[mysqld]
datadir=/var/lib/mysql
#Added for CloudStack
innodb_rollback_on_timeout=1
innodb_lock_wait_timeout=600
max_connections=350
log-bin=mysql-bin
binlog-format = ‘ROW’
#Above are for CloudStack
socket=/var/lib/mysql/mysql.sock
user=mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0</p>

<p>[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
[/shell]</p>

<p>Restart MySQL server.</p>

<p>[shell]
[root@cloudstack CloudStack-oss-3.0.2-1-rhel6.2] service mysqld restart
Stop mysqld：                                              [OK]
Starting mysqld：                                          [OK]
[/shell]</p>

<p>Set MySQL root password:
[shell]
[root@cloudstack home] mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.1.52-log Source distribution</p>

<p>Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.
This software comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to modify and redistribute it under the GPL v2 license</p>

<p>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.</p>

<p>mysql&gt; set password = password(‘citrix’);
Query OK, 0 rows affected (0.00 sec)</p>

<p>mysql&gt; exit
Bye
[/shell]</p>

<p>Initialisation Cloudtack management server database.
[shell]
[root@cloudstack home] cloud-setup-databases cloud:citrix@localhost –deploy-as=root:citrix
Mysql user name:cloud                                                           [ OK ]
Mysql user password:citrix                                                      [ OK ]
Mysql server ip:localhost                                                       [ OK ]
Mysql server port:3306                                                          [ OK ]
Mysql root user name:root                                                       [ OK ]
Mysql root user password:citrix                                                 [ OK ]
Checking Cloud database files …                                               [ OK ]
Checking local machine hostname …                                             [ OK ]
Checking SELinux setup …                                                      [ OK ]
Detected local IP address as 192.168.10.15, will use as cluster management server node IP[ OK ]
Preparing /etc/cloud/management/db.properties                                   [ OK ]
Applying /usr/share/cloud/setup/create-database.sql                             [ OK ]
Applying /usr/share/cloud/setup/create-schema.sql                               [ OK ]
Applying /usr/share/cloud/setup/create-database-premium.sql                     [ OK ]
Applying /usr/share/cloud/setup/create-schema-premium.sql                       [ OK ]
Applying /usr/share/cloud/setup/server-setup.sql                                [ OK ]
Applying /usr/share/cloud/setup/templates.sql                                   [ OK ]
Applying /usr/share/cloud/setup/create-index-fk.sql                             [ OK ]
Processing encryption …                                                       [ OK ]
Finalizing setup …                                                            [ OK ]</p>

<p>CloudStack has successfully initialized database, you can check your database configuration in /etc/cloud/management/db.properties
[/shell]</p>

<p>Database initialization successful, then we need to run CloudStack setup command.
[shell]
[root@cloudstack home] cloud-setup-management
Starting to configure CloudStack Management Server:
Configure sudoers …         [OK]
Configure Firewall …        [OK]
Configure CloudStack Management Server …[OK]
CloudStack Management Server setup is Done!
[/shell]</p>

<p>After we have installed CloudStack management server. We are going to create storage. I use my management server for setting up NFS share. It’s convenient and easy enough. But according CloudStack document, you’d better attached a 16 TB NFS storage on management server. If you have pls use it. For me 250 GB HD is good for my testing purpose. You may have one more Linux machine for NFS server, then you can follow my steps.</p>

<p>[shell]
[root@cloudstack ~] service rpcbind start
[root@cloudstack ~] service nfs start
Start NFS server：                                            [OK]
Stop NFS quota：                                            [OK]
Start NFS service：                                        [OK]
Start NFS mountd：                                          [OK]
[root@cloudstack ~] chkconfig nfs on
[root@cloudstack ~] chkconfig rpcbind on
[root@cloudstack home] cd /home
[root@cloudstack home] mkdir primary
[root@cloudstack home] mkdir secondary
[root@cloudstack home] vi /etc/exports   #set NFS path
[root@cloudstack home] cat /etc/exports
/home    *(rw,async,no_root_squash)
[root@cloudstack home] exportfs -a
[root@cloudstack home] exportfs
/home             <world>
[/shell]</world></p>

<p>Edit /etc/sysconfig/nfs file, for sure it has follow parameter.
[shell]
MOUNTD_NFS_V3=”yes”
LOCKD_TCPPORT=32803
LOCKD_UDPPORT=32769
MOUNTD_PORT=892
RQUOTAD_PORT=875
STATD_PORT=662
STATD_OUTGOING_PORT=2020
[/shell]</p>

<p>Restart NFS server, you’d better test it from a XenServer host. To for sure XenServer can read and write NFS share:
[shell]
[root@xs root]mkdir test
[root@xs root]mount 192.168.10.15:/home  /root/test
[root@xs root]ls test
[root@xs root]touch testfile   #this file must be showed by ls on both management server and XenServer host.
[/shell]</p>

<p>Test your intenet connection from management server, We need to download system vm template and install it on management server.
[shell]
/usr/lib64/cloud/agent/scripts/storage/secondary/cloud-install-sys-tmplt -m /home/secondary -u http://download.cloud.com/templates/acton/acton-systemvm-02062012.vhd.bz2 -h xenserver -F
正在解析主机 download.cloud.com… 207.171.189.81
正在连接 download.cloud.com|207.171.189.81|:80… 已连接。
已发出 HTTP 请求，正在等待回应… 200 OK
长度：140616708 (134M) [binary/octet-stream]</p>

<p>99% [===================================================================================================&gt; ] 140,512,160  149K/s eta(英国中部时
99% [===================================================================================================&gt; ] 140,551,600  145K/s eta(英国中部时
100%[====================================================================================================&gt;] 140,616,708  155K/s   in 11m 27s
2012-06-29 20:03:57 (200 KB/s) - 已保存 “/usr/lib64/cloud/agent/scripts/storage/secondary/a5fc3577-c5e7-49ff-8fbf-ed88dc8aaff5.vhd” [140616708/140616708])</p>

<p>Uncompressing to /usr/lib64/cloud/agent/scripts/storage/secondary/a5fc3577-c5e7-49ff-8fbf-ed88dc8aaff5.vhd.tmp (type bz2)…could take a long time
Moving to /home/secondary/template/tmpl/1/1///a5fc3577-c5e7-49ff-8fbf-ed88dc8aaff5.vhd…could take a while
Successfully installed system VM template  to /home/secondary/template/tmpl/1/1/
[/shell]
Go into secondary storage folder to verify template file, check the file size.</p>

<p>I use a 32GB HP latop for XenServer, it’s in same network subnet with management server, and it also can access internet.</p>

<p>XenServer installation note:</p>

<ol>
  <li>
    <p>Download XenServer 6.0.201 iso image, it can work with CloudStack 3.0.201 well</p>
  </li>
  <li>
    <p>Internet access is convenient for download CloudStack support package.</p>
  </li>
  <li>
    <p>Using same 0~3.xenserver.pool.ntp.org NTP server</p>
  </li>
</ol>

<p>Access XenServer host from my management server. There are some post-install steps need to be done for CloudStack.
[shell]
[root@cloudstack .ssh]# ssh 192.168.10.10   #Connect to XenServer host ip address
The authenticity of host ‘192.168.10.10 (192.168.10.10)’ can’t be established.
RSA key fingerprint is ae:5b:8a:dc:2a:c8:6c:56:f6:7a:48:02:e6:db:78:dd.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added ‘192.168.10.10’ (RSA) to the list of known hosts.
root@192.168.10.10’s password:
Type “xsconsole” for access to the management console.
[root@hpxs1 ~] pwd
/root
[root@hpxs1 ~] mkdir tmp
[root@hpxs1 ~] cd tmp
[root@hpxs1 tmp] wget http://download.cloud.com/releases/3.0.1/XS-6.0.2/xenserver-cloud-supp.tgz
–2012-06-29 21:55:08–  http://download.cloud.com/releases/3.0.1/XS-6.0.2/xenserver-cloud-supp.tgz
Resolving download.cloud.com… 207.171.185.201
Connecting to download.cloud.com|207.171.185.201|:80… connected.
HTTP request sent, awaiting response… 200 OK
Length: 3342001 (3.2M) [application/x-tar]
Saving to: `xenserver-cloud-supp.tgz’</p>

<p>100%[================================================================&gt;] 3,342,001    217K/s   in 15s</p>

<p>2012-06-29 21:55:49 (214 KB/s) - `xenserver-cloud-supp.tgz’ saved [3342001/3342001]
[root@hpxs1 tmp] tar xf xenserver-cloud-supp.tgz
[root@hpxs1 tmp] ls
example-answerfile   post-install.sh  src                       xenserver-cloud-supp.tgz
packages.cloud-supp  README           xenserver-cloud-supp.iso
[root@hpxs1 tmp] xe-install-supplemental-pack xenserver-cloud-supp.iso
Installing ‘XenServer Cloud Supp Pack’…</p>

<p>Preparing…                ########################################### [100%]
1:iptables               ########################################### [ 10%]
2:iptables-ipv6          ########################################### [ 20%]
3:arptables              ########################################### [ 30%]
4:iptables-debuginfo     ########################################### [ 40%]
5:ipset-modules-kdump-2.6########################################### [ 50%]
6:ipset-modules-xen-2.6.3########################################### [ 60%]
7:csp-pack               ########################################### [ 70%]
8:ebtables               ########################################### [ 80%]
9:ipset                  ########################################### [ 90%]
10:iptables-devel         ########################################### [100%]
Update sysctl to enable <em>tables checking
Memory required by all installed packages: 894697472
Truncating to static-max: 789839872
Setting VM.memory_target: 789839872
Pack installation successful.
[root@hpxs1 tmp]
[root@hpxs1 tmp] xe-switch-network-backend bridge
Cleaning up old ifcfg files
Remove… ifcfg-xenbr0
Disabling openvswitch daemon
Configure system for bridge networking
You *MUST</em> now reboot your system
[root@hpxs1 tmp] reboot
[/shell]</p>

<p>Test if NFS storage is up and running for my XenServer host.
[shell]
[root@hpxs1 ~] mkdir nfs
[root@hpxs1 ~] mount 192.168.10.15:/home/primary /root/nfs
[root@hpxs1 ~] cd nfs
[root@hpxs1 nfs] touch testfile
[root@hpxs1 nfs] ls
testfile   #Check this file inside NFS folder.
[/shell]</p>

<p>Now, it’s time to initialize CloudStack on management server. It has a very nice wizard for helping you lunching your zone.
[nggallery id=14]</p>

<p>I had followed above to installed CloudStack twice within less 3 hours. If you get other tips/issue, pls drop me a comment, I will try my best to response you.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="http://martinliu.cn/page40/" class="btn">向前</a></li>
      
    

    
    
      <li><a href="http://martinliu.cn">1</a></li>
    

    
    
      
      
      <li>…</li>
    

    
    
    

    
      
        
        
        
        <li><a href="http://martinliu.cn/page39/">39</a></li>
      
    
      
        
        
        
        <li><a href="http://martinliu.cn/page40/">40</a></li>
      
    
      
        <li><strong class="current-page">41</strong></li>
      
    
      
        
        
        
        <li><a href="http://martinliu.cn/page42/">42</a></li>
      
    
      
        
        
        
        <li><a href="http://martinliu.cn/page43/">43</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="http://martinliu.cn/page94/">94</a></li>
    

    
    
      <li><a href="http://martinliu.cn/page42/" class="btn">下一页</a></li>
    
  </ul>
</div>



</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Martin Liu.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://martinliu.cn/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://martinliu.cn/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-749876-6', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


          

</body>
</html>