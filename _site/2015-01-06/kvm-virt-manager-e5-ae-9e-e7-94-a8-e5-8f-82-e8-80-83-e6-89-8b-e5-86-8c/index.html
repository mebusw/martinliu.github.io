<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>KVM Virt-Manager  实用参考手册</title>

  <meta name="author" content="Martin Liu" />

  

  <link rel="alternate" type="application/rss+xml" title="Martin's Blog - DevOps Coach & Cloud Expert!" href="/feed.xml" />

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="KVM Virt-Manager  实用参考手册" />
  

   
  <meta property="og:description" content="关于 virt manager Virt Manager 是一个不错的kvm虚拟机管理工具，能够方便地管理虚拟机。我的测试机目前已经完全转向RHEL7上跑KVM虚拟机，通过virt-manager去管理的方案。 安装virt-manager：yum install -y virt-* ； 装完之后重新启动机器即可使用。 建议初始配置 安装完后有几个环境的配置推荐可以做一下。 Storage Pool ： 一个默认的 + 两个自建的 Default ：这是virt-manager安装时默认创建的，它和操作系统在同一个卷上，我的测试机使用SSD卷，因此我所有虚拟机都会使用这个卷，这样速度比较快 hd ：这是测试机上普通磁盘的一个目录，目的是把那些不需要快速IO的虚拟机跑着这里，节省SSD的磁盘空间 iso ：这是普通磁盘上的iso文件目录，单独挂在这是为了，使用方便 虚拟网络 （一个默认+两个新建） default ： 这个是安装了virt-manager + kvm 之后就有的，是用NAT的方式，带dhcp，默认虚拟机可以连接物理机所在的外围 virbr1/virbr2 ：是我根据自己的需要建立的，只能和host物理机通讯，无dhcp 我最近做OpenStack的实践，OpenStack需要最好隔离的几个网络跑不同的数据，因此virbr1/2正好符合OpenStack的测试需求。另外我在物理机的操作系统上搭建了yum源服务器，因此任何一个虚拟机都可以通过http访问我放在物理机上的repo目录，我只需要更新这些repos目录里面的rpm包的内容，我的lab环境中的所有虚拟机（不管是在何网络）都可以使用到最新的系统更新包和软件包了。这样大大提高了虚拟机里面软件测试的效率，所有虚拟机像是在本地安装rpm软件包一样，再也不需要联网下载，我只需要每周去公司联网同步一下这些目录即可。 有了以上配置之后，就可以高效工作了，效率感觉比vmware workstation要高，速度快稳定。下面是虚拟机创建的流程，里面有些我的推荐做法。 本想看下，virt-install 的使用方式，感觉那个参数太多，容易敲错，还是界面比较容易上手，而且出错的机会不高。 命令行常用操作指南（持续更新中） virt-manager主要操作还是在命令行比较高效，特别是下面的这些操作，在使用过程中，比较多用，用的多了感觉比GUI操作方式效率高多了。 virt-manager的命令行功能调用有两种方式： 直接 virsh 回车 ，之后就进入了 virsh #...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/2015-01-06/kvm-virt-manager-e5-ae-9e-e7-94-a8-e5-8f-82-e8-80-83-e6-89-8b-e5-86-8c/" />
  <link rel="canonical" href="http://localhost:4000/2015-01-06/kvm-virt-manager-e5-ae-9e-e7-94-a8-e5-8f-82-e8-80-83-e6-89-8b-e5-86-8c/" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/head-200-200.jpg" />
  
  

  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@zliu" />
  <meta name="twitter:creator" content="@zliu" />

  
  <meta name="twitter:title" content="KVM Virt-Manager  实用参考手册" />
  

  
  <meta name="twitter:description" content="关于 virt manager Virt Manager 是一个不错的kvm虚拟机管理工具，能够方便地管理虚拟机。我的测试机目前已经完全转向RHEL7上跑KVM虚拟机，通过virt-manager去管理的方案。 安装virt-manager：yum install -y virt-* ； 装完之后重新启动机器即可使用。 建议初始配置 安装完后有几个环境的配置推荐可以做一下。 Storage Pool ： 一个默认的 + 两个自建的 Default ：这是virt-manager安装时默认创建的，它和操作系统在同一个卷上，我的测试机使用SSD卷，因此我所有虚拟机都会使用这个卷，这样速度比较快 hd ：这是测试机上普通磁盘的一个目录，目的是把那些不需要快速IO的虚拟机跑着这里，节省SSD的磁盘空间 iso ：这是普通磁盘上的iso文件目录，单独挂在这是为了，使用方便 虚拟网络 （一个默认+两个新建） default ： 这个是安装了virt-manager + kvm 之后就有的，是用NAT的方式，带dhcp，默认虚拟机可以连接物理机所在的外围 virbr1/virbr2 ：是我根据自己的需要建立的，只能和host物理机通讯，无dhcp 我最近做OpenStack的实践，OpenStack需要最好隔离的几个网络跑不同的数据，因此virbr1/2正好符合OpenStack的测试需求。另外我在物理机的操作系统上搭建了yum源服务器，因此任何一个虚拟机都可以通过http访问我放在物理机上的repo目录，我只需要更新这些repos目录里面的rpm包的内容，我的lab环境中的所有虚拟机（不管是在何网络）都可以使用到最新的系统更新包和软件包了。这样大大提高了虚拟机里面软件测试的效率，所有虚拟机像是在本地安装rpm软件包一样，再也不需要联网下载，我只需要每周去公司联网同步一下这些目录即可。 有了以上配置之后，就可以高效工作了，效率感觉比vmware workstation要高，速度快稳定。下面是虚拟机创建的流程，里面有些我的推荐做法。 本想看下，virt-install 的使用方式，感觉那个参数太多，容易敲错，还是界面比较容易上手，而且出错的机会不高。 命令行常用操作指南（持续更新中） virt-manager主要操作还是在命令行比较高效，特别是下面的这些操作，在使用过程中，比较多用，用的多了感觉比GUI操作方式效率高多了。 virt-manager的命令行功能调用有两种方式： 直接 virsh 回车 ，之后就进入了 virsh #...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/head-200-200.jpg" />
  

</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
        <a class="navbar-brand" href="http://localhost:4000">Martin's Blog</a>
      
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            
            





<a href="/aboutme">About Me</a>

          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Resources</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="http://www.aws-faq.com/">AWS-FAQ.com</a>

                
              
                
                  
            





<a href="http://devopscoach.org">devopscoach.org</a>

                
              
            </div>
          </li>
        
        
      </ul>
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000 ">
	      <img class="avatar-img" src="/img/head-200-200.jpg" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>KVM Virt-Manager  实用参考手册</h1>
		  
		  
		  
		  <span class="post-meta">Posted on January 6, 2015</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      <article role="main" class="blog-post">
        <h1 id="virt-manager">关于 virt manager</h1>

<p>Virt Manager 是一个不错的kvm虚拟机管理工具，能够方便地管理虚拟机。我的测试机目前已经完全转向RHEL7上跑KVM虚拟机，通过virt-manager去管理的方案。</p>

<p><a href="http://cdn1.martinliu.cn/wp-content/uploads/2015/01/topbar_logo.png"><img src="http://cdn1.martinliu.cn/wp-content/uploads/2015/01/topbar_logo.png" alt="topbar_logo" /></a></p>

<p>安装virt-manager：yum install -y virt-* ； 装完之后重新启动机器即可使用。</p>

<h1 id="section">建议初始配置</h1>

<p>安装完后有几个环境的配置推荐可以做一下。</p>

<p><img src="http://martinliu.cn/wp-content/gallery/virt-manager-kvm-1/Screenshot-from-2015-01-06-193413.png" alt="点击New Volume" /></p>

<p>Storage Pool ： 一个默认的 + 两个自建的</p>

<ul>
  <li>
    <p>Default ：这是virt-manager安装时默认创建的，它和操作系统在同一个卷上，我的测试机使用SSD卷，因此我所有虚拟机都会使用这个卷，这样速度比较快</p>
  </li>
  <li>
    <p>hd ：这是测试机上普通磁盘的一个目录，目的是把那些不需要快速IO的虚拟机跑着这里，节省SSD的磁盘空间</p>
  </li>
  <li>
    <p>iso ：这是普通磁盘上的iso文件目录，单独挂在这是为了，使用方便</p>
  </li>
</ul>

<p><img src="http://martinliu.cn/wp-content/gallery/virt-manager-kvm-1/Screenshot-from-2015-01-06-210927.png" alt="自建的内外1" /></p>

<p>虚拟网络 （一个默认+两个新建）</p>

<ul>
  <li>
    <p>default ： 这个是安装了virt-manager + kvm 之后就有的，是用NAT的方式，带dhcp，默认虚拟机可以连接物理机所在的外围</p>
  </li>
  <li>
    <p>virbr1/virbr2 ：是我根据自己的需要建立的，只能和host物理机通讯，无dhcp</p>
  </li>
</ul>

<p>我最近做OpenStack的实践，OpenStack需要最好隔离的几个网络跑不同的数据，因此virbr1/2正好符合OpenStack的测试需求。另外我在物理机的操作系统上搭建了yum源服务器，因此任何一个虚拟机都可以通过http访问我放在物理机上的repo目录，我只需要更新这些repos目录里面的rpm包的内容，我的lab环境中的所有虚拟机（不管是在何网络）都可以使用到最新的系统更新包和软件包了。这样大大提高了虚拟机里面软件测试的效率，所有虚拟机像是在本地安装rpm软件包一样，再也不需要联网下载，我只需要每周去公司联网同步一下这些目录即可。</p>

<p>有了以上配置之后，就可以高效工作了，效率感觉比vmware workstation要高，速度快稳定。下面是虚拟机创建的流程，里面有些我的推荐做法。</p>

<p><img src="http://martinliu.cn/nextgen-attach_to_post/preview/id--53382" alt="" /></p>

<p>本想看下，virt-install 的使用方式，感觉那个参数太多，容易敲错，还是界面比较容易上手，而且出错的机会不高。</p>

<h1 id="section-1">命令行常用操作指南（持续更新中）</h1>

<p>virt-manager主要操作还是在命令行比较高效，特别是下面的这些操作，在使用过程中，比较多用，用的多了感觉比GUI操作方式效率高多了。</p>

<p>virt-manager的命令行功能调用有两种方式：</p>

<ul>
  <li>
    <p>直接 virsh 回车 ，之后就进入了 virsh # 的一个专门的shell，help 就能看的里面支持的所有命令</p>
  </li>
  <li>
    <p>在普通shell下 直接 virsh <操作命令> <参数>，</参数></操作命令></p>
  </li>
</ul>

<p>这两个方式的调用没有差异，感觉全凭个人的操作习惯。</p>

<p>下面是一些常用的虚拟机管理功能命令参数和实例。</p>

<p>开启一个虚拟机</p>

<p>virsh # start server8-a</p>

<p>查看所有虚拟机(on and off)</p>

<p>virsh list –all</p>

<p>关闭一个虚拟机</p>

<p>virsh # shutdown server8-a</p>

<p>对一个虚拟机作一个快照</p>

<p>snapshot-create-as server8-a flat-os “before customization”</p>

<p>查看虚拟的所有快照</p>

<p>snapshot-list server8-a</p>

<p>返回到之前的一个snapshot</p>

<p>virsh # snapshot-revert  –domain server8-a flat-os</p>

<p>克隆一个虚拟机到新文件（用于模板的复制创建新vm，或者vm的备份）<br />
[root@w540 Desktop]# virt-clone -o rhel70-tmp -n rhel70-tmp-clone -f /data/vm/cloned-new-vm.img<br />
Cloning rhel7-tmp.img                                                                             | 195 GB  00:00:03     <br />
Clone ‘rhel70-tmp-clone’ created successfully.</p>

      </article>

      
        <div class="blog-tags">
          Tags:
          
            KVM
          
        </div>
      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">

  <!--- Share on Twitter -->
  
    <a href="https://twitter.com/intent/tweet?text=KVM+Virt-Manager++%E5%AE%9E%E7%94%A8%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C+http://localhost:4000/2015-01-06/kvm-virt-manager-e5-ae-9e-e7-94-a8-e5-8f-82-e8-80-83-e6-89-8b-e5-86-8c/"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fa fa-fw fa-twitter" aria-hidden="true"></span>
    </a>
  

  <!--- Share on Facebook -->
  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2015-01-06/kvm-virt-manager-e5-ae-9e-e7-94-a8-e5-8f-82-e8-80-83-e6-89-8b-e5-86-8c/"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fa fa-fw fa-facebook" aria-hidden="true"></span>
    </a>
  

  <!--- Share on Google Plus -->
  

  <!--- Share on LinkedIn -->
  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2015-01-06/kvm-virt-manager-e5-ae-9e-e7-94-a8-e5-8f-82-e8-80-83-e6-89-8b-e5-86-8c/"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fa fa-fw fa-linkedin" aria-hidden="true"></span>
    </a>
  

</section>



      

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/2014-12-24/wget-e4-b8-8b-e8-bd-bd-e5-a4-a7-e6-96-87-e4-bb-b6-e6-96-ad-e7-82-b9-e7-bb-ad-e4-bc-a0/" data-toggle="tooltip" data-placement="top" title="wget 下载大文件-断点续传">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/2015-01-10/rhel-e6-80-a7-e8-83-bd-e6-8f-90-e5-8d-87-e6-96-b9-e6-b3-95-e5-92-8c-e5-b7-a5-e5-85-b7/" data-toggle="tooltip" data-placement="top" title="RHEL 性能 提升方法和工具">Next Post &rarr;</a>
        </li>
        
      </ul>

      
        <div class="disqus-comments">
          

        </div>
      
    </div>
  </div>
</div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/martinliu" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
	  
      
          <li>
            <a href="https://plus.google.com/+MartinLiu-cn" title="Google+">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
          <li>
            <a href="mailto:67120666@qq.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
		  
		  
      
      
      
      
      
		  
        </ul>
        <p class="copyright text-muted">
		  Martin Liu
		  &nbsp;&bull;&nbsp;
		  2017

		  
		  &nbsp;&bull;&nbsp;
		  <a href="http://localhost:4000">martinliu.cn</a>
		  
	    </p>
	        <!-- Please don't remove this, keep my open source work credited :) -->
		<p class="theme-by text-muted">
		
		</p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/main.js"></script>
    
  




  
  </body>
</html>
