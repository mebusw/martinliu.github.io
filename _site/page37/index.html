<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Martin's Blog</title>
<meta name="description" content="DevOps Coach & Cloud Expert">
<meta name="keywords" content="DevOps, Cloud, AWS, HCI, Nutanix, ITSM">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/path.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="DevOps Coach & Cloud Expert">
<meta name="twitter:creator" content="@zliu">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="DevOps Coach & Cloud Expert">
<meta property="og:url" content="/page37/">
<meta property="og:site_name" content="Martin's Blog">





<link rel="canonical" href="/page37/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Martin's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">首页</a></li>
		<li>
			<a href="#">关于</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Martin Liu photo" class="author-photo">
					<h4>Martin Liu</h4>
					<p>DevOps Coach, Cloud Expert, Runner</p>
				</li>
				<li><a href="/about/"><span class="btn btn-inverse">详情</span></a></li>
				<li>
					<a href="mailto:67120666@qq.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/zliu"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://google.com/+MartinLiu-cn"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="https://linkedin.com/in/liuzheng"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/martinliu"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">文章</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">所有文章</a></li>
				<li><a href="/tags/">所有分类</a></li>
			</ul>
		</li>
		
	    
	    <li><a href="http://www.aws-faq.com" target="_blank">AWS-FAQ</a></li>
	  
	    
	    <li><a href="http://devopscoach.org" target="_blank">DevOps教练</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="/images/path.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Martin's Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-12-11T17:04:44+08:00"><a href="/2012/12/11/cloudstack4-e5-ae-89-e8-a3-85-e5-ae-9e-e4-be-8b-e5-88-86-e6-9e-90-e7-89-88/">December 11, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2012/12/11/cloudstack4-e5-ae-89-e8-a3-85-e5-ae-9e-e4-be-8b-e5-88-86-e6-9e-90-e7-89-88/" rel="bookmark" title="CloudStack 4.0 安装实例分析版" itemprop="url">CloudStack 4.0 安装实例分析版</a></h1>
    
  </header>
  <div class="entry-content">
    <p>我之前的安装帖子，只讲了CloudStack的环境如何去搭建，并没讲为什么这么做？也没讲做出来的东西有什么用？也没讲做出来以后该如何去扩展这个系统？所以可能那些文档可能只是对于开发人有点意义，对于实际用户而言意义并不大。后面，我可能用几篇文章来描述和解答这些问题。</p>

<p>这里先讲一个应用实例，有需求的人应该能够看懂，并且能领会到系统设计和规划的原理。CS公司内网有大约50个研发人员，每个人为了开发和测试公司的产品至少需要2种操作系统环境（Windows2008+Ubuntu），每个操作系统至少需要2个虚拟机才能保证正常工作，有人还有编译代码的需求，所以平均每人需要4core/6GB的计算资源。总共需要200个虚拟机，总共需要200Core*300GB的计算资源。</p>

<!-- more -->
<p><a href="http://cdn1.martinliu.cn/wp-content/uploads/2012/12/Cloud.png"><img src="http://cdn1.martinliu.cn/wp-content/uploads/2012/12/Cloud-300x256.png" alt="" /></a></p>

<p>CS公司的工程师做了这样的一个设计，首先申请了一个独立网段192.168.168.0用于该测试CloudStack。然后找来了两台服务器用于平台的初始化安装，IP地址的规划如下表。另外，CS公司的网管也给他们借了一个千兆网络交换机，这个交换机配置了网关和DNS解析，保证测试网段的机器既能够上网，并能够被公司内网连接。</p>
<table cellpadding="0" cellspacing="0" border="1">
<tbody>
<tr>

<td width="140" valign="top">IP地址
</td>

<td width="429" valign="top">功能
</td>
</tr>
<tr>

<td width="140" valign="top">192.168.168.1
</td>

<td width="429" valign="top">网关和DNS解析的地址，通过它所有虚拟机可以被内网用户访问
</td>
</tr>
<tr>

<td width="140" valign="top">192.168.168.2
</td>

<td width="429" valign="top">CloudStack管理服务器，配置为2*4Core/16GB/1TB*2HD，安装RHEL6.2操作系统，安装NFS服务
</td>
</tr>
<tr>

<td width="140" valign="top">192.168.168.3
</td>

<td width="429" valign="top">XS-01为第一台Hypervisor服务器，用户运行虚拟机，这里使用XenServer，安装之后在网上申请免费许可证用来测试满足50人的配置为4*4Core(开超线程)/64GB/125GB*2HD的服务器7台；或者相当计算量的其他计算资源。
</td>
</tr>
<tr>

<td width="140" valign="top">192.168.168.4～14
</td>

<td width="429" valign="top">为后期系统扩展新增的XenServer服务器预留
</td>
</tr>
<tr>

<td width="140" valign="top">192.168.168.15
</td>

<td width="429" valign="top">为后期扩容的存储系统预留，如果开发编译的过程没有密集的磁盘读写操作的话，使用NFS或iSCSI存储即可。否则考虑使用FC存储。
</td>
</tr>
<tr>

<td width="140" valign="top">92.168.168.16～20
</td>

<td width="429" valign="top">CloudStack Private网段地址
</td>
</tr>
<tr>

<td width="140" valign="top">92.168.168.21～25
</td>

<td width="429" valign="top">CloudStack Storage网段地址
</td>
</tr>
<tr>

<td width="140" valign="top">92.168.168.30～250
</td>

<td width="429" valign="top">CloudStack Guest网段地址
</td>
</tr>
</tbody>
</table>
<p>图中左侧的两台服务器就是最小化的测试环境，足够满足CloudStack平台搭建，和虚拟机模板的测试工作。等到测试和配置足够了，就可以增加更多的服务器节点到CloudStack平台上来。增加的方法很简单，在服务器上安装XenServer之后，在CloudStack中添加host即可。</p>

<p>准备系统安装软件
根据以上的需求需要下载和刻录RHEL6.2的安装盘；需要下载ClouStack的安装包，http://cloudstack.apt-get.eu/rhel/4.0/ 。 CloudStack的安装包可以下载到本地，保持它的目录结构不变，回头放到装好的RHEL服务器的Apache目录中建立本机安装源。</p>

<p>系统安装
安装的过程已经在CloudStack官方文档上有了非常详细的描述。本次就不逐条命令解释了。
这里只想讲几点须注意的地方。根据CS公司的这个需求，建议使用的CloudStack管理服务器需要稍微大一点的本地磁盘和内存；根据我最近的测试发现管理服务器和NFS服务器混用的情况下，服务器内存的消耗还是蛮大的，为了保证速度16GB应该非常够用，我的测试机只有4GB还是虚拟机，速度也很快。本地磁盘最好是两块1TB的高速磁盘做Raid10，或者多块小盘也行，最好Raid做完之后有大约1TB的存储空间；以便存放测试初期的系统模板和虚拟机的磁盘和快照文件。</p>

<p>最后我想从系统配置文件的角度讲一下在RHEL操作系统里面都修改了那些文件。</p>

<p>安装源文件需要两个：
rhel6.repo RHEL系统可以选择默认最小安装，这样装的最快，装好以后，把DVD mount上，在做成源，这样需要什么包，直接yum install就行了，非常方便快捷
cloudstack.repo CloudStack的所有安装包都可以放在CloudStack管理服务器本机的Apache服务器上，另外这个Apache服务器还可以作为上传系统模板的中转站。
[bash]
[root@cs40 yum.repos.d]# pwd
/etc/yum.repos.d
[root@cs40 yum.repos.d]# ls
cloudstack.repo redhat.repo rhel6.repo rhel-source.repo
[root@cs40 yum.repos.d]# cat rhel6.repo
[rhel6]
name=rhel6
baseurl=file:///media/
enabled=1
gpgcheck=0
[root@cs40 yum.repos.d]# cat cloudstack.repo
[cloudstack]
name=cloudstack
baseurl=http://127.0.0.1/4.0/
enabled=1
gpgcheck=0
[root@cs40 yum.repos.d]#
[/bash]
主机hosts和network文件，RHEL服务器必须要能正确的解析出自己的fqdn
[bash][root@cs40 yum.repos.d]# cat /etc/hosts
127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4
192.168.168.2 cs40.cs-cloud.com cs40
[root@cs40 sysconfig]# cat /etc/sysconfig/network
NETWORKING=yes
HOSTNAME=cs40.cs-cloud.com
[/bash]
Mysql数据库需启动服务之后，才能修改my.cnf配置文件，加入CloudStack所需要的参数之后重启服务，参数如下：
[bash][mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
user=mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0</p>

<p>#CloudStack need them
innodb_rollback_on_timeout=1
innodb_lock_wait_timeout=600
max_connections=350
log-bin=mysql-bin
binlog-format = ‘ROW’
#CloudStack need theme</p>

<p>[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
[/bash]</p>

<p>其他相关的配置文件我已经打包了，有需要参考的，请到我下载，这里就不做逐一的解释。</p>

<p>[download id=”16” format=”2”]</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-12-05T17:34:48+08:00"><a href="/2012/12/05/cs40-e5-ae-89-e8-a3-85-e6-89-8b-e5-86-8c/">December 05, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2012/12/05/cs40-e5-ae-89-e8-a3-85-e6-89-8b-e5-86-8c/" rel="bookmark" title="CS40安装手册" itemprop="url">CS40安装手册</a></h1>
    
  </header>
  <div class="entry-content">
    <p>CS4.0的升级貌似变化不大，随后会更新一个最新版的简明安装手册出来</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-11-15T15:38:29+08:00"><a href="/2012/11/15/e5-a6-82-e4-bd-95-e5-9c-a8-e5-91-bd-e4-bb-a4-e8-a1-8c-e6-89-93xenserver-e7-9a-84-e8-a1-a5-e4-b8-81/">November 15, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2012/11/15/e5-a6-82-e4-bd-95-e5-9c-a8-e5-91-bd-e4-bb-a4-e8-a1-8c-e6-89-93xenserver-e7-9a-84-e8-a1-a5-e4-b8-81/" rel="bookmark" title="如何在命令行打XenServer的补丁" itemprop="url">如何在命令行打XenServer的补丁</a></h1>
    
  </header>
  <div class="entry-content">
    <p>参考文献：</p>

<p><a href="http://xmodulo.blogspot.com.au/2012/10/how-to-apply-xenserver-patch.html">http://xmodulo.blogspot.com.au/2012/10/how-to-apply-xenserver-patch.html</a>
Installing the hotfix using the CLI on another host</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. Download the hotfix to the computer running the CLI or XenCenter, and extract the .xsupdate file from the ZIP file.


2. Open a Command Prompt window. On Windows computers, navigate to the XenCenter installation directory, typically located at C:\Program Files (x86)\Citrix\XenCenter


3. Upload the hotfix to the pool master by entering the following command.
</code></pre>
</div>

<blockquote>xe patch-upload -s `<hostname>
```
 -u root -pw `<password>
```
 file-name=`<updatefilepath>
```
 XS55EU2012.xsupdate&lt;/blockquote&gt;


Where <hostname> is the IP address or DNS name of the pool master, <password> is the root account password, and <updatefilepath> is the path to the .xsupdate file.

The UUID of the hotfix is displayed. XenServer assigns the UUID to the .xsupdate file.

	
    4. Type the following command to apply the hotfix to all hosts in the pool.


<blockquote>xe patch-pool-apply uuid=d632016d-352d-4fd9-8829-5a74ef0625db</blockquote>




	
    5. Verify that the update was applied using the following command.


<blockquote>xe patch-list -s `<hostname>
```
 -u root -pw `<password>
```
 name-label=XS55EU2012&lt;/blockquote&gt;


Where <hostname> is the IP address or DNS name of the pool master and <password> is the root account password.

The hosts field contains the UUIDs of the hosts to which the hotfix was successfully applied. If the update is successful, all the hosts in the pool are listed.

	
    6. For each host, migrate any VMs that you want to keep running and shut down the remaining VMs before restarting the host.The hotfix is applied to all hosts in the pool, but does not take effect until each host is restarted.



To verify in XenCenter that the update was applied correctly, select the pool in the resources pane and then click the **General** tab in the properties pane. Expand the **Updates** section of the pool properties and ensure that the update is listed as **Fully applied**.

我的测试过程如下：

建立了一个NFS共享，上传了所有下载并且压缩所有补丁文件，积累了一堆的.xsupdate文件；在master上mount这个nfs文件共享。进去之后我所使用的命令如下：

[bash]
[root@xs-04 602patch]# xe patch-upload file-name =XS602E003.xsupdate
26b72ceb-759c-4de3-b007-e2a5fc30a93a
[root@xs-04 602patch]# xe patch-upload file-name =XS602E004.xsupdate
7f363047-46f2-41b7-8ff2-141d88e7b4ec
[root@xs-04 602patch]# xe patch-upload file-name =XS602E005.xsupdate
9b84b5c0-a027-11e1-a8b1-0800200c9a66
[root@xs-04 602patch]# xe patch-upload  file-name =XS602E006.xsupdate
b6f7bfe0-b969-11e1-afa6-0800200c9a66
[root@xs-04 602patch]# xe patch-upload  file-name =XS602E008.xsupdate
7c04fd30-9a0a-4894-9662-05ca9f866162
[root@xs-04 602patch]# xe patch-upload  file-name =XS602E009.xsupdate
6c9f9c22-d4b9-4c39-9343-7f0e6d0104b5
[root@xs-04 602patch]# xe patch-list 
uuid ( RO) : 7f363047-46f2-41b7-8ff2-141d88e7b4ec
name-label ( RO): XS602E004
name-description ( RO): Public Availability: CVE-2012-0217 security fix
size ( RO): 776629
hosts (SRO):
after-apply-guidance (SRO): restartHost

uuid ( RO) : 945655fe-2dcd-46eb-b224-e556aa2f22b8
name-label ( RO): XS602E002
name-description ( RO): Public Availability: Fix for VMs hanging when pa rsing fragmented IPv6 packet
size ( RO): 0
hosts (SRO): 016c2e53-3e1d-4273-a350-f89447614903
after-apply-guidance (SRO): restartXAPI

uuid ( RO) : 68276dea-a818-4970-af93-3e43cb37b426
name-label ( RO): XS602E001
name-description ( RO): Public Availability: Mark VMs with old PV driver s as out-of-date
size ( RO): 0
hosts (SRO): 016c2e53-3e1d-4273-a350-f89447614903
after-apply-guidance (SRO): restartXAPI

uuid ( RO) : 7c04fd30-9a0a-4894-9662-05ca9f866162
name-label ( RO): XS602E008
name-description ( RO): Public Availability: security fixes to Xen and d evice model
size ( RO): 2784821
hosts (SRO):
after-apply-guidance (SRO): restartHost

uuid ( RO) : b6f7bfe0-b969-11e1-afa6-0800200c9a66
name-label ( RO): XS602E006
name-description ( RO): Public availability: Fixes to Integrated Storage Link.
size ( RO): 14530669
hosts (SRO):
after-apply-guidance (SRO): restartXAPI

uuid ( RO) : 9b84b5c0-a027-11e1-a8b1-0800200c9a66
name-label ( RO): XS602E005
name-description ( RO): Public Availability: Kernel and Storage fixes
size ( RO): 38529042
hosts (SRO):
after-apply-guidance (SRO): restartHost

uuid ( RO) : 6c9f9c22-d4b9-4c39-9343-7f0e6d0104b5
name-label ( RO): XS602E009
name-description ( RO): Public Availability: XenTools fixes
size ( RO): 117525717
hosts (SRO):
after-apply-guidance (SRO):

uuid ( RO) : 26b72ceb-759c-4de3-b007-e2a5fc30a93a
name-label ( RO): XS602E003
name-description ( RO): Public Availability: Xapi hotfix for incorrect V NC port advertisement.
size ( RO): 7454760
hosts (SRO):
after-apply-guidance (SRO): restartXAPI

[root@xs-04 ~]# xe patch-pool-apply  uuid=6c9f9c22-d4b9-4c39-9343-7f 0e6d0104b5
[root@xs-04 ~]# xe patch-pool-apply  uuid=9b84b5c0-a027-11e1-a8b1-08 00200c9a66
[root@xs-04 ~]# xe patch-pool-apply  uuid=b6f7bfe0-b969-11e1-afa6-08 00200c9a66
[root@xs-04 ~]# xe patch-pool-apply  uuid=7f363047-46f2-41b7-8ff2-14 1d88e7b4ec
[root@xs-04 ~]# xe patch-pool-apply  uuid=7c04fd30-9a0a-4894-9662-05
[root@xs-04 ~]#reboot
[/bash]

我是在单机的XenServer上打的补丁，打完之后只需要一次重即可。比较在XenCenter里面打补丁，这个方法更快捷，更节省时间。
</password></hostname></password></hostname></blockquote></updatefilepath></password></hostname></updatefilepath></password></hostname></blockquote>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-10-30T22:46:41+08:00"><a href="/2012/10/30/e5-87-ba-e5-b7-ae-e5-b0-b1-e7-89-99-e7-96-bc/">October 30, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2012/10/30/e5-87-ba-e5-b7-ae-e5-b0-b1-e7-89-99-e7-96-bc/" rel="bookmark" title="出差就牙疼" itemprop="url">出差就牙疼</a></h1>
    
  </header>
  <div class="entry-content">
    <p>每周出差无法终止，看不到了尽头。错过了家里第一个home made面包，损失大发了。
希望合作伙伴么，快速成长，在那里都做保姆式的项目守护，SE的宿命不会就这样持续下去吧。
压力全都聚集到压根上了。出差第二天准保压痛，不用吃药，冒失回家两天就会消退。</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2012-10-28T23:40:01+08:00"><a href="/2012/10/28/xenapp-xendesktop-receiver-3-3-e5-ba-94-e7-94-a8-e5-95-86-e5-ba-97-e6-9c-80-e4-bd-b3-e5-ae-9e-e8-b7-b5/">October 28, 2012</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2012/10/28/xenapp-xendesktop-receiver-3-3-e5-ba-94-e7-94-a8-e5-95-86-e5-ba-97-e6-9c-80-e4-bd-b3-e5-ae-9e-e8-b7-b5/" rel="bookmark" title="Receiver 3.3+应用商店最佳实践" itemprop="url">Receiver 3.3+应用商店最佳实践</a></h1>
    
  </header>
  <div class="entry-content">
    <p>前一篇博客“<a href="http://martinliu.cn/2012/09/让用户畅游在云的大同世界里.html">让用户畅游在云的大同世界里”</a>提到了提到了Receiver 3.3以及我所期望用到的最主要功能：同时连接并登陆多个虚拟化站点，让所有用户使用的虚拟应用（桌面）都汇聚（聚合）到用户终端上。这样做的需求源于：很多客户都有多个网络隔离的，多个地域隔离；用户的移动性决定了，做应用发布汇聚的必要性，这样也就奠定了CloudGateway的需求的根本。<!-- more -->
<a href="http://cdn1.martinliu.cn/wp-content/uploads/2012/09/cg-architecture-inpg_v2.png"><img src="http://cdn1.martinliu.cn/wp-content/uploads/2012/09/cg-architecture-inpg_v2.png" alt="" /></a></p>

<p>在Reciever 3.3让用户犹如登陆了自己的iTune，可以浏览已经购买的应用，这些应用的图标就在界面的首页上，如果需要使用按个常用应用可以随时点击启动它；对于那些还没有使用过的应用，可以点击左侧的分类，浏览添加，当然也可以使用应用商店的搜索，找到自己需要的应用。那么这些应用是哪里来的？它们的来源有两个：1）StoreFront 应用商店；2）AppControler 应用控制中心；StoreFront负责会不和对外发布XenDesktop和XenApp群集中的应用；AppControler主要负责发布SaaS和移动应用；这样用户从Receiver 3.3（电脑和各种移动设备）端，完整的获得企业要提供给用户的所有种类的应用服务，包括：XenDesk/XenApp后端的各种业务应用、SaaS应用、移动设备应用（IOS和Andriod app）和传统业务应用和内容。注意这是一种全新的应用交付方式，它新在：用户和IT的人都完全不用关心任何一个应用在客户端上的安装、需求、升级、补丁和支持的问题，这些问题全都交给了数据中IT团队在虚拟应用和桌面交付平台上统一管理。任何一种应用访问，对于用户来说就是一种IT服务，用户只需通过Receiver使用这种服务，而不需要对这个服务的数据安全、软件维护等任何技术问题操心。</p>

<p>到此为止，我已经说道了本文要讲的主线：Reciever 3.3 -&gt; AG -&gt; StoreFront -&gt; XenDesktop/XenApp ；在这条路径上AG运行在NetScaler上是前端和后台的分水岭，AG外侧是用户，AG内侧是数据中心内部。那么，老的Receiver，或者说叫做Online Plugin和非老的已存在的XenDesktop和XenApp到哪里去了，看下下面的图，你就明白了。</p>

<p><img src="http://martinliu.cn/wp-content/gallery/citrix/receiver33.png" alt="receiver33" /></p>

<p>如上图所示，老的Receiver或者online plugin不能通过AG连接到应用商店里面，只能走以前的老路，那么也就不能享受到我上面所的所有的好处。New Receiver只的就是我所说的Reciever 3.3。但是它不能通过AG连接WI。说道这里不得不说，我上周在用户现场测试的辛苦经历。我要的其实只是New Receiver对应的这条路径。但是，没有向导Storefont是必须的，因此倒是吧上面的路径配通了，而迟迟无法实现Receiver 3.3所能达到的理想的状态。</p>

<p>上面全都是正确的废话，下面开始分享对工程师有用的干货。下面我按照上图的五个层次依次总结一下，我上周在一个政府项目实施案例中的经验和教训：</p>

<p>[tab label=”Receiver” first=”yes”]
Receiver的选择，能做到多账户同时登陆，聚合多个账户中后台系统虚拟资源的版本目前只有Receiver for windows 3.3 版本（Mac版和其它版本，我还没有测过）；而不是其它任何版本，如果你是初次玩Receiver的话，进到下载里面，一定会被搞晕掉，它不是：Receiver for windows的任何版本，包括3.2、 3.1 。也不是所有Online Plugin联机插件的各个版本，它们属于Existing Receiver这一类。 [box color=”orange” icon=”flag”]
分析一下你的实际需求，然后再决定该使用那个版本；这是一个重要的决定，它确定了你是否需要部署Storefront和AppControler这两个服务。
[/box]
[/tab]</p>

<p>[tab label=”Access Gateway”]
AG的选择，如果涉及Receiver 3.3的话，AG上有两几个关键点。首先AG的系统最好是NS10的，很多文档和POC手册都是和10相关的，而且和StoreFront搭配起来都算是同期产品版本，应该会比较好一些。下面是我们在实施现场的一些AG配置总结：
[list icon=”check”]</p>

<ul>
  <li>
    <p>StoreFront的地址用IP而不是DNS</p>
  </li>
  <li>
    <p>STA在AG中还是要配置</p>
  </li>
  <li>
    <p>用HTTP和StoreFront关联而不是HTTPS</p>
  </li>
  <li>
    <p>继续使用ICA proxy（这个一定要用，不然只能用Smartaccess模式了）</p>
  </li>
  <li>
    <p>去除了Clientless相关策略，不用AppController，不需要这个配置</p>
  </li>
</ul>

<p>[/list]
从这些配置方式来看，还有StoreFont服务，在不使用AppControler的情况下，AG的配置策略以前的AG传统的配置方法区别不大；但是如果有AppController 和第三方SaaS应用就不一样了，那样的话还是要参考<a href="http://support.citrix.com/article/CTX131908">KB <strong>CTX131908</strong></a>中的策略来配，不过这个KB没有谈到以上的那些要点，我要不是受到NS大师的指导，几乎就被带到沟里去了。
[/tab]</p>

<p>[tab label=”StoreFront WI” ]
这里只说下StoreFront，这就是我说的应用商店，有了它你就可以保持所有用户的应用订购信息。从发展的眼光看，它应该是WI的一个替换，但是在一段时间内，肯定需要和WI并存。它的安装文件在CloudGateway产品中可以下载，是一个103兆的安装包，可以装在win2008 R2 64bit的系统上，需要MS SQL数据库的支持。可以做多节点的群集，那样就需要想WI一样在前面放负载均衡器。它其实能够让Receiver和Online Plugin同时使用。这里稍微介绍一点它的结构，它里面有两个重要部件：Receiver 商店站点，这是让Receiver直连的；Receiver for Web 商店站点，这个是为了照顾老版本的Online Plugin而设计的，老版本的用户也可以访问应用商店，但是它们只能通过Web的方式登陆，登陆后能看到和Native Win32版的Receiver for Windows 3.3相同样式的深绿色界面，和应用商店内容。点击应用后，ICA连接还是可以通过Online Plugin 正常建立。</p>

<p>[/tab]</p>

<p>[tab label=”应用和桌面” last=”yes”]
XenDesktop和XenApp这里就不在多说，由于目前我也没有实际测试AppControler的实施经验所以，经验配置部分的内容待续。</p>

<p>不过AppControler应该十个很好的东西，有了它才能企业内部的IT管理人员把应用发布服务的面辐射到每个角落，才能让更方便地为用户管理SaaS应用，才能让Receiver端可以正常使用Share File这样的网盘数据服务。
[/tab]</p>

<p>参考链接：
[list icon=”star”]</p>

<ul>
  <li>
    <p><a href="http://support.citrix.com/proddocs/topic/receiver-windows-33/nl/zh/cn/receiver-windows-wrapper.html?locale=cn">Receiver for Windows 3.3 中文在线帮助文档</a></p>
  </li>
  <li>
    <p><a href="http://support.citrix.com/proddocs/topic/dws-storefront-12/nl/zh/cn/dws-version-wrapper.html?locale=cn">StoreFront 1.2 中文在线帮助文档</a></p>
  </li>
  <li>
    <p><a href="http://support.citrix.com/proddocs/topic/access-gateway/nl/zh/access-gateway-10/agee-xa-xd-integration-edocs-landing.html">Access Gateway 10 集成说明</a></p>
  </li>
  <li>
    <p><a href="http://support.citrix.com/article/CTX131908">How to Configure Access to Citrix Receiver StoreFront through Access Gateway Enterprise Edition</a></p>
  </li>
</ul>

<p>[/list]</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="/page36/" class="btn">向前</a></li>
      
    

    
    
      <li><a href="">1</a></li>
    

    
    
      
      
      <li>…</li>
    

    
    
    

    
      
        
        
        
        <li><a href="/page35/">35</a></li>
      
    
      
        
        
        
        <li><a href="/page36/">36</a></li>
      
    
      
        <li><strong class="current-page">37</strong></li>
      
    
      
        
        
        
        <li><a href="/page38/">38</a></li>
      
    
      
        
        
        
        <li><a href="/page39/">39</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="/page94/">94</a></li>
    

    
    
      <li><a href="/page38/" class="btn">下一页</a></li>
    
  </ul>
</div>



</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Martin Liu.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>



          

</body>
</html>