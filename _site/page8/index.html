<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Martin's Blog</title>
<meta name="description" content="DevOps Coach & Cloud Expert">
<meta name="keywords" content="DevOps, Cloud, AWS, HCI, Nutanix, ITSM">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://martinliu.cn/images/path.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="DevOps Coach & Cloud Expert">
<meta name="twitter:creator" content="@zliu">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="DevOps Coach & Cloud Expert">
<meta property="og:url" content="http://martinliu.cn/page8/">
<meta property="og:site_name" content="Martin's Blog">

<meta name="google-site-verification" content="4oSwNTpy1vzip3_lt6XhkhMfImCD_DZlvL3K1k-M8qk">



<link rel="canonical" href="http://martinliu.cn/page8/">
<link href="http://martinliu.cn/feed.xml" type="application/atom+xml" rel="alternate" title="Martin's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://martinliu.cn/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://martinliu.cn/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://martinliu.cn/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://martinliu.cn/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://martinliu.cn/images/apple-touch-icon.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://martinliu.cn/images/apple-touch-icon-72x72.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://martinliu.cn/images/apple-touch-icon-114x114.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://martinliu.cn/images/apple-touch-icon-144x144.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://martinliu.cn/">首页</a></li>
		<li>
			<a href="#">关于</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://martinliu.cn/images/avatar.jpg" alt="Martin Liu photo" class="author-photo">
					<h4>Martin Liu</h4>
					<p>DevOps Coach, Cloud Expert, Runner</p>
				</li>
				<li><a href="http://martinliu.cn/about/"><span class="btn btn-inverse">详情</span></a></li>
				<li>
					<a href="mailto:67120666@qq.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/zliu"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://google.com/+MartinLiu-cn"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="https://linkedin.com/in/liuzheng"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/martinliu"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">文章</a>
			<ul class="dl-submenu">
				<li><a href="http://martinliu.cn/posts/">所有文章</a></li>
				<li><a href="http://martinliu.cn/tags/">所有分类</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="http://martinliu.cn/images/path.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Martin's Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-06-18T22:14:51+08:00"><a href="http://martinliu.cn/2015/06/18/icinga2-e7-9b-91-e6-8e-a7-e5-b7-a5-e5-85-b7-e8-af-84-e6-b5-8b/">June 18, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2015/06/18/icinga2-e7-9b-91-e6-8e-a7-e5-b7-a5-e5-85-b7-e8-af-84-e6-b5-8b/" rel="bookmark" title="icinga2 监控工具评测" itemprop="url">icinga2 监控工具评测</a></h1>
    
  </header>
  <div class="entry-content">
    <p>本来想写一个安装手册，可是安装完成之后发现其实非常简单，最后就把题目改为评测了。本文也不是全面的评测文章，关于它的能力和功能，待后续了解的深入了在继续更新本文。</p>

<h2 id="icinga2-">icinga2 架构分析</h2>

<p>请下载和查看这个icinga2官方的文档：[su_button url=”http://pan.baidu.com/s/1qW3JkJE” target=”blank” style=”stroked” background=”#cccc00” size=”6” icon=”icon: cubes”]下载点这里[/su_button]</p>

<p><a href="http://cdn1.martinliu.cn/wp-content/uploads/2015/06/Selection_001.png"><img src="http://cdn1.martinliu.cn/wp-content/uploads/2015/06/Selection_001-1024x542.png" alt="Selection_001" /></a></p>

<p>为什么用icinga，原因如下：</p>

<p>[su_list icon=”icon: eye”]</p>

<ul>
  <li>
    <p>Nagios的架构不能扩展</p>
  </li>
  <li>
    <p>增加模块是比较困难的</p>
  </li>
  <li>
    <p>不是群集和分布式监控架构</p>
  </li>
  <li>
    <p>安全性相对糟糕</p>
  </li>
  <li>
    <p>配置功能有限</p>
  </li>
</ul>

<p>[/su_list]</p>

<h2 id="section">安装配置</h2>

<p>icinga2的安装可以说非常简洁，基本上配置好yum源，几条命令就装万了，而且就可以用了。只是在web界面选择和配置上稍微有点麻烦，它目前有三个可以安装配置的界面：classic, icinga-web, icinga-web2； classic太老了，不具有极其强烈的怀旧情节，就别碰了。建议生产环境中还是使用icinga-web；web2太新了，很多集成的项目的都还没有做好，还比较初级，功能不完善。</p>

<p><del>待续</del>~~</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-06-17T00:25:34+08:00"><a href="http://martinliu.cn/2015/06/17/e5-9c-a8-rhel-7-e4-b8-8a-e5-ae-89-e8-a3-85-foreman-1-8/">June 17, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2015/06/17/e5-9c-a8-rhel-7-e4-b8-8a-e5-ae-89-e8-a3-85-foreman-1-8/" rel="bookmark" title="在 RHEL 7 上安装 Foreman 1.8" itemprop="url">在 RHEL 7 上安装 Foreman 1.8</a></h1>
    
  </header>
  <div class="entry-content">
    <p>首先安装RHEL7使用光盘安装最小化系统，安装完成之后，关闭防火墙和SELinux（为了测试方便），配置主机名为FQDN格式，如 fm1.8.xenlab.com； 加本机的主机名解析到/etc/hosts 文集中。之后注册到RHN。</p>

<p>[bash]</p>

<p>[root@fm18 ~]# subscription-manager register
[root@fm18 ~]# subscription-manager attach  –auto
[root@fm18 ~]# subscription-manager repos –disable=”*”
[root@fm18 ~]# subscription-manager repos –enable=rhel-7-server-optional-rpms
[root@fm18 ~]# subscription-manager repos –enable=rhel-server-rhscl-7-rpms
[root@fm18 ~]# subscription-manager repos –enable=rhel-7-server-rpms
[root@fm18 ~]# rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm
[root@fm18 ~]# yum -y install http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm
[root@fm18 ~]# yum -y install http://ftp.sjtu.edu.cn/fedora/epel/epel-release-latest-7.noarch.rpm
[root@fm18 ~]# yum clean all
[root@fm18 ~]# yum makecache
[root@fm18 ~]# yum update -y
[root@fm18 ~]# reboot
[root@fm18 ~]# yum install foreman-installer</p>

<p>[/bash]</p>

<p>安装foreman-installer可能会出现的错误是ruby包依赖的问题，导致这个问题的原因可能有：网速太满导致的yum meta-data 失效，国外的epel源下载失败等。解决方法是：使用国内较快的epel源，在安装foreman-installer前，清除yum 缓存，重新建立yum原数据缓存。</p>

<p>我的测试机的yum 源配置如下：</p>

<p>[bash]</p>

<p>[root@fm18 yum.repos.d]# yum repolist
Loaded plugins: fastestmirror, product-id, subscription-manager
Loading mirror speeds from cached hostfile
* epel: mirrors.neusoft.edu.cn
repo id repo name status
epel/x86_64 Extra Packages for Enterprise Linux 7 - x86_64 8,076
foreman/x86_64 Foreman 1.8 379
foreman-plugins/x86_64 Foreman plugins 1.8 199
puppetlabs-deps/x86_64 Puppet Labs Dependencies El 7 - x86_64 17
puppetlabs-products/x86_64 Puppet Labs Products El 7 - x86_64 175
rhel-7-server-optional-rpms/7Server/x86_64 Red Hat Enterprise Linux 7 Server - Optional (RPMs) 5,832
rhel-7-server-rpms/7Server/x86_64 Red Hat Enterprise Linux 7 Server (RPMs) 7,036
rhel-server-rhscl-7-rpms/7Server/x86_64 Red Hat Software Collections RPMs for Red Hat Enterprise Linux 7 Server 3,596
repolist: 25,310
[root@fm18 yum.repos.d]# cat /etc/yum.repos.d/epel.repo
[epel]
name=Extra Packages for Enterprise Linux 7 - $basearch
baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;arch=$basearch
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=https://fedoraproject.org/static/352C64E5.txt</p>

<p>mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;arch=$basearch
[epel-debuginfo]
name=Extra Packages for Enterprise Linux 7 - $basearch - Debug
baseurl=http://ftp.sjtu.edu.cn/fedora/epel/7/$basearch/debug
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&amp;arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1</p>

<p>[epel-source]
name=Extra Packages for Enterprise Linux 7 - $basearch - Source
baseurl=http://ftp.sjtu.edu.cn/fedora/epel/7/SRPMS
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&amp;arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1
[root@fm18 yum.repos.d]#</p>

<p>[/bash]</p>

<p>以上应该是安装foreman-installer宝过的攻略了。接下来该安装foreman的各个组建和插件了。使用 foreman-installer -i 发现是个不错的方法。还可以顺便了解一下当前foreman版本的各个主要功能项，如下所示：</p>

<p>[bash]</p>

<p>[root@fm18 yum.repos.d]# foreman-installer -i
Welcome to the Foreman installer!
———————————</p>

<p>This wizard will gather all required information. You can change any parameter
to your needs.</p>

<p>Ready to start? (y/n) y</p>

<p>Main Config Menu
1. [✓] Configure foreman
2. [✓] Configure foreman_cli
3. [✗] Configure foreman_compute_ec2
4. [✗] Configure foreman_compute_gce
5. [✓] Configure foreman_compute_libvirt
6. [✗] Configure foreman_compute_openstack
7. [✓] Configure foreman_compute_ovirt
8. [✗] Configure foreman_compute_rackspace
9. [✗] Configure foreman_compute_vmware
10. [✓] Configure foreman_plugin_bootdisk
11. [✗] Configure foreman_plugin_chef
12. [✓] Configure foreman_plugin_default_hostgroup
13. [✗] Configure foreman_plugin_digitalocean
14. [✓] Configure foreman_plugin_discovery
15. [✗] Configure foreman_plugin_docker
16. [✗] Configure foreman_plugin_hooks
17. [✗] Configure foreman_plugin_openscap
18. [✗] Configure foreman_plugin_ovirt_provision
19. [✗] Configure foreman_plugin_puppetdb
20. [✗] Configure foreman_plugin_salt
21. [✓] Configure foreman_plugin_setup
22. [✓] Configure foreman_plugin_tasks
23. [✗] Configure foreman_plugin_templates
24. [✓] Configure foreman_proxy
25. [✗] Configure foreman_proxy_plugin_abrt
26. [✗] Configure foreman_proxy_plugin_chef
27. [✗] Configure foreman_proxy_plugin_openscap
28. [✗] Configure foreman_proxy_plugin_pulp
29. [✗] Configure foreman_proxy_plugin_salt
30. [✓] Configure puppet
31. Display current config
32. Save and run
33. Cancel run without Saving
Choose an option from the menu…</p>

<p>[root@fm18 yum.repos.d]# puppet agent –test
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Caching catalog for fm18.xenlab.com
Info: Applying configuration version ‘1434466089’
Notice: Finished catalog run in 0.21 seconds
[root@fm18 yum.repos.d]#</p>

<p>[/bash]</p>

<p>输入数字即可进入每个选项打开和关闭这个功能和服务，这个是对foreman的功能配置管理，不光是首次安装可以使用，以后的服务器功能变更也可以这么作，这个对我这样不感冒answerfile的人来说甚好。如果是首次安装，可以什么都不选择，来一个说装就装的默认安装也不错。安装完全成功之后，就会显示登陆网址和 管理与密码等信息。用初始的admin密码登陆后，修改密码，你的全新的foreman就安装成功了。注意在，运行foreman-installer过程中是需要联网的，安装过程会按照需求，下载所需要的组建包，例如数据库和web服务器等等其它必须的包。登陆后界面如下：</p>

<p>[gallery size=”medium” link=”file” ids=”53781,53782,53783”]</p>

<p>接下来需要作配置自动化的测试了，我做了一个录像，通过一个简单的示例来说明，如何在foreman中测试pupput module。过程中我使用一个最简单的 /etc/motd 文件的配置的类。演示的内容涉及：</p>

<p>[su_list icon=”icon: check-square”]</p>

<ul>
  <li>
    <p>安装puppet module 到生产环境中</p>
  </li>
  <li>
    <p>导入并且定制puppet 类的功能</p>
  </li>
  <li>
    <p>测试和验证puppet 类是否工作正常</p>
  </li>
</ul>

<p>[/su_list]</p>

<p>视频下载：[su_button url=”http://pan.baidu.com/s/1ntpBXfN” target=”blank” style=”stroked” background=”#cccccc” size=”6” icon=”icon: cloud-download”]下载在这里[/su_button]</p>

<p>本文参考文档：</p>

<ul>
  <li>
    <p><a href="http://theforeman.org/manuals/1.8/index.htm">http://theforeman.org/manuals/1.8/index.htm</a></p>
  </li>
  <li>
    <p><a href="http://itgeeker.net/centos-7-epel-china-mirror-repository/">http://itgeeker.net/centos-7-epel-china-mirror-repository/</a></p>
  </li>
</ul>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-06-13T22:27:17+08:00"><a href="http://martinliu.cn/2015/06/13/e7-94-a8-powertop-e7-bb-99-e7-ac-94-e8-ae-b0-e6-9c-ac-e7-94-b5-e8-84-91-e7-9c-81-e7-94-b5/">June 13, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2015/06/13/e7-94-a8-powertop-e7-bb-99-e7-ac-94-e8-ae-b0-e6-9c-ac-e7-94-b5-e8-84-91-e7-9c-81-e7-94-b5/" rel="bookmark" title="用 powertop 给笔记本电脑省电" itemprop="url">用 powertop 给笔记本电脑省电</a></h1>
    
  </header>
  <div class="entry-content">
    <p>如何安装：</p>

<p>[bash]</p>

<p>sudo dnf install powertop</p>

<p>sudo powertop</p>

<p>sudo systemctl start powertop.service</p>

<p>sudo systemctl enable powertop.service</p>

<p>[/bash]</p>

<p>[gallery link=”file” ids=”53761,53762,53763,53764,53765”]</p>

<p>使用Tab和shift + tab 键在以上屏幕直接切换。</p>

<p>我发现我主要使用 Tunables 这个tab来找出可以安全关闭的设备服务。以上测试是在我目前的 Fedora 22 on Lenovo T440s上作的。</p>

<p>本文参考：<a href="http://fedoramagazine.org/saving-laptop-power-with-powertop/">http://fedoramagazine.org/saving-laptop-power-with-powertop/</a></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-06-08T00:35:05+08:00"><a href="http://martinliu.cn/2015/06/08/e5-9c-a8centos-7-e4-b8-8a-e5-ae-89-e8-a3-85-e9-83-a8-e7-bd-b2katello2-2/">June 08, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2015/06/08/e5-9c-a8centos-7-e4-b8-8a-e5-ae-89-e8-a3-85-e9-83-a8-e7-bd-b2katello2-2/" rel="bookmark" title="在CentOS 7上安装部署Katello2.2" itemprop="url">在CentOS 7上安装部署Katello2.2</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Katello的系统架构如下图：</p>

<p><img src="http://cdn1.martinliu.cn/wp-content/uploads/2015/06/katello-arch-diagram.png" alt="katello-arch-diagram" /></p>

<p>Katell系统是一个复合型开源项目，是Pulp, Candlepin 和 Foreman的组合。Foreman默认使用Puppet作配置管理。</p>

<p>它的安装文档见官方手册：<a href="http://www.katello.org/docs/2.2/installation/index.html">http://www.katello.org/docs/2.2/installation/index.html</a></p>

<p>为了简化安装，请下在本站提供的CentOS7完美安装模板。使用它来创建一个虚拟机，6GB内存，2VCPU；网络上为了方便，请在virt-manger中新建如下所示的网络。</p>

<p><img src="http://cdn1.martinliu.cn/wp-content/uploads/2015/06/QEMU-KVM-Connection-Details_006.png" alt="QEMU-KVM Connection Details_006" /></p>

<p>虚拟机启动之后，确保host能正常联网。启动刚才创建的虚拟机，配置好IP，ping 外网网站，确保它能正常联网即可。其它安装命令如下：</p>

<p>[bash]</p>

<p>yum -y localinstall http://fedorapeople.org/groups/katello/releases/yum/2.2/katello/RHEL/7Server/x86_64/katello-repos-latest.rpm
yum -y localinstall http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm
yum -y localinstall http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm
yum -y localinstall http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
yum -y install foreman-release-scl</p>

<p>yum -y install katello</p>

<p>katello-installer -v \
–foreman-admin-username admin \
–foreman-admin-password smartvm \
–capsule-dns true \
–capsule-dns-interface eth0 \
–capsule-dns-zone xenlab.com \
–capsule-dns-forwarders 192.168.10.1 \
–capsule-dns-reverse 10.168.192.in-addr.arpa \
–capsule-dhcp true \
–capsule-dhcp-interface eth0 \
–capsule-dhcp-range “192.168.10.100 192.168.10.240” \
–capsule-dhcp-gateway 192.168.10.1 \
–capsule-dhcp-nameservers 192.168.10.10 \
–capsule-tftp true \
–capsule-tftp-servername $(hostname) \
–capsule-puppet true \
–capsule-puppetca true</p>

<p>[/bash]</p>

<p>以上的安装命令如果成功，katello服务器将具有一下功能：</p>

<ol>
  <li>
    <p>Foreman 服务器：用于自动化网络安装linux系统</p>
  </li>
  <li>
    <p>Puppet Master服务器</p>
  </li>
  <li>
    <p>Repos管理服务器</p>
  </li>
  <li>
    <p>DNS，DHCP，PXE服务器</p>
  </li>
</ol>

<p>安装成功之后，使用默认的用户名和密码就可以登陆了。</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-06-05T23:44:52+08:00"><a href="http://martinliu.cn/2015/06/05/e5-ae-89-e8-a3-85-e5-ae-8c-e7-be-8e-centos7-e8-99-9a-e6-8b-9f-e6-9c-ba-e6-a8-a1-e6-9d-bf/">June 05, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://martinliu.cn/about/" title="About Martin Liu">Martin Liu</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://martinliu.cn/2015/06/05/e5-ae-89-e8-a3-85-e5-ae-8c-e7-be-8e-centos7-e8-99-9a-e6-8b-9f-e6-9c-ba-e6-a8-a1-e6-9d-bf/" rel="bookmark" title="安装完美 CentOS7 虚拟机模板" itemprop="url">安装完美 CentOS7 虚拟机模板</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="section">初始化安装</h2>

<p>下载最新版CentOS7 DVD 选择mini安装。</p>

<h2 id="section-1">网络配置</h2>

<p>安装过程中设置了静态网络地址，如下：</p>

<p>[bash]</p>

<p>[root@centos7-tmp ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
TYPE=Ethernet
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
NAME=eth0
DEVICE=eth0
ONBOOT=yes
DNS1=192.168.10.1
DOMAIN=xenlab.com
IPADDR=192.168.10.8
PREFIX=24
GATEWAY=192.168.10.1
UUID=5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03</p>

<p>[/bash]</p>

<h2 id="section-2">软件包</h2>

<p>Change log:</p>

<ol>
  <li>
    <p> yum install wget <a href="http://itgeeker.net/tag/telnet/">telnet</a> perl perl-devel net-tools kernel-devel</p>
  </li>
  <li>
    <p>yum install vim-enhanced.x86_64</p>
  </li>
  <li>
    <p>yum -y install git</p>
  </li>
  <li>
    <p>yum install acpid</p>
  </li>
  <li>
    <p>yum install tree</p>
  </li>
  <li>
    <p>yum install ntp</p>
  </li>
  <li>
    <p>yum install unzip</p>
  </li>
</ol>

<h2 id="repo-">Repo 软件更新源</h2>

<p>Change log:</p>

<ol>
  <li>
    <p>初始化安装，添加了个几个国内的源</p>
  </li>
  <li></li>
</ol>

<p>rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm</p>

<ol>
  <li>
    <p>/etc/yum.repo/bk/dvd.repo ；这个是在用KVM虚拟机挂ISO文件光驱的时候用的，到时候 mount /dev/cdrom /media/dvd , 把该文件方的夫目录中即可使用iso文件中的repos</p>
  </li>
  <li></li>
</ol>

<p>当前的软件源如下：</p>

<p>[bash]</p>

<p>[root@centos7-tmp ~]# yum repolist
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Loading mirror speeds from cached hostfile
* base: mirrors.163.com
* epel: mirrors.neusoft.edu.cn
* extras: mirrors.btte.net
* remi-safe: remi.kazukioishi.net
* updates: mirrors.btte.net
repo id                                 repo name                                                                          status
base/7/x86_64                           CentOS-7 - Base                                                                    8,652
epel/x86_64                             Extra Packages for Enterprise Linux 7 - x86_64                                     8,022
extras/7/x86_64                         CentOS-7 - Extras                                                                    128
remi-safe                               Safe Remi’s RPM repository for Enterprise Linux 7 - x86_64                           123
updates/7/x86_64                        CentOS-7 - Updates                                                                   609
repolist: 17,534
[root@centos7-tmp ~]#</p>

<p>[/bash]</p>

<h2 id="section-3">系统服务配置</h2>

<p>Change log:</p>

<ol>
  <li>
    <p>关闭SELinux</p>
  </li>
  <li>
    <p>关闭 NetworkManager</p>
  </li>
  <li>
    <p>关闭 FirewallD</p>
  </li>
  <li>
    <p>systemctl enable acpid.service</p>
  </li>
  <li>
    <p>开启 truned-adm virtual-guest 服务模式</p>
  </li>
  <li>
    <p>systemctl enable ntpd</p>
  </li>
</ol>

<p>[bash]</p>

<p>[root@centos7-tmp tuned]# tuned-adm  list
Cannot talk to Tuned daemon via DBus.
Available profiles:
- balanced
- desktop
- latency-performance
- network-latency
- network-throughput
- powersave
- throughput-performance
- virtual-guest
- virtual-host
Cannot talk to Tuned daemon via DBus.
It seems that tuned daemon is not running, preset profile is not activated.
Preset profile: virtual-guest</p>

<p>[/bash]</p>

<h2 id="section-4">模板文件封装</h2>

<p>用sys-unconfig 关机。用 virt-sysprep,  virt-sparsify 去除不必要信息，压缩。</p>

<p>[bash]</p>

<p>[root@martin-fedora vm]# ll -h
total 12G
-rw-r–r–  1 qemu qemu  81G Jun  5 22:36 centos7-tmp.qcow2
-rw-r–r–  1 root root  81G Jun  5 22:34 centos7-tmp.qcow2.bk
-rw-r–r–  1 root root 2.9G Jun  5 07:56 rhel66-clone-1.qcow2
-rw-r–r–  1 root root 1.6G Jun  3 15:01 rhel66-clone.qcow2
-rw-r–r–  1 root root  81G Jun  3 13:03 rhel66.qcow2
-rw-r–r–. 1 root root  81G Jun  1 00:59 rhel71.qcow2
[root@martin-fedora vm]# export TMPDIR=/home/martin
[root@martin-fedora vm]# virt-sparsify –compress centos7-tmp.qcow2 centos7-tmp-v1.qcow2
Input disk virtual size = 85899345920 bytes (80.0G)
Create overlay file in /home/martin to protect source disk …
Examine source disk …
Fill free space in /dev/centos/root with zero …
100% ⟦▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒⟧ 00:00
Clearing Linux swap on /dev/centos/swap …
100% ⟦▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒⟧ 00:00
Fill free space in /dev/sda1 with zero …
Fill free space in volgroup centos with zero …
Copy to destination and make sparse …</p>

<p>Sparsify operation completed with no errors.  Before deleting the old disk,
carefully check that the target disk boots and works correctly.
[root@martin-fedora vm]# ll -h
total 12G
-rw-r–r–  1 qemu qemu  81G Jun  5 22:36 centos7-tmp.qcow2
-rw-r–r–  1 root root  81G Jun  5 22:34 centos7-tmp.qcow2.bk
-rw-r–r–  1 root root 520M Jun  5 23:11 centos7-tmp-v1.qcow2
-rw-r–r–  1 root root 2.9G Jun  5 07:56 rhel66-clone-1.qcow2
-rw-r–r–  1 root root 1.6G Jun  3 15:01 rhel66-clone.qcow2
-rw-r–r–  1 root root  81G Jun  3 13:03 rhel66.qcow2
-rw-r–r–. 1 root root  81G Jun  1 00:59 rhel71.qcow2</p>

<p>[/bash]</p>

<h2 id="yum-update--y">yum update -y</h2>

<ul>
  <li>
    <p>2015-07-10 : Done yum updated. 删除了不需要的Kernel，安装了unzip, 修改启动过程为直接文字启动。</p>
  </li>
  <li>
    <p>2015-11.15: update kernel to 7.1, set old kernel 1: package-cleanup –oldkernels –count=1</p>
  </li>
</ul>

<h2 id="section-5">使用方法</h2>

<p>root 密码 martinliu.cn 开机后记得一定要先修改。</p>

<p>百度网盘下载地址 [su_button url=”http://pan.baidu.com/s/1pJurap9” target=”blank” style=”stroked” size=”6” icon=”icon: codepen”]centos7-tmp-v7[/su_button]</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="http://martinliu.cn/page7/" class="btn">向前</a></li>
      
    

    
    
      <li><a href="http://martinliu.cn">1</a></li>
    

    
    
      
      
      <li>…</li>
    

    
    
    

    
      
        
        
        
        <li><a href="http://martinliu.cn/page6/">6</a></li>
      
    
      
        
        
        
        <li><a href="http://martinliu.cn/page7/">7</a></li>
      
    
      
        <li><strong class="current-page">8</strong></li>
      
    
      
        
        
        
        <li><a href="http://martinliu.cn/page9/">9</a></li>
      
    
      
        
        
        
        <li><a href="http://martinliu.cn/page10/">10</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="http://martinliu.cn/page94/">94</a></li>
    

    
    
      <li><a href="http://martinliu.cn/page9/" class="btn">下一页</a></li>
    
  </ul>
</div>



</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Martin Liu.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://martinliu.cn/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://martinliu.cn/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-749876-6', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


          

</body>
</html>